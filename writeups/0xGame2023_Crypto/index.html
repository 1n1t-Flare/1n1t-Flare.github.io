<!DOCTYPE html>
<html lang="zh-cn" dir="ltr" class="scroll-smooth" data-default-appearance="dark"
  data-auto-appearance="true"><head><script src="/github.io/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=github.io/livereload" data-no-instant defer></script>
  <meta charset="utf-8" />
  
  <meta http-equiv="content-language" content="zh-cn" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta http-equiv="X-UA-Compatible" content="ie=edge" />
  
  <title>0xGame2023 Crypto &middot; 1n1t-Flare Blog</title>
  <meta name="title" content="0xGame2023 Crypto &middot; 1n1t-Flare Blog" />
  
  <meta name="description" content="crypto writeup of 0xgame2023" />
  <meta name="keywords" content="CTF, Crypto, " />
  
  
  <link rel="canonical" href="http://localhost:1313/github.io/writeups/0xgame2023_crypto/" />
  
  
  
  
  
  
  
  
  
  
  <link type="text/css" rel="stylesheet" href="/github.io/css/main.bundle.min.67eb0befb1fb57e6528684f3a2ff6e0606a82100504705b66488d54a9f3fda9c2605c9bf3b70163208427288637a7b4d1a168384c1115e417458eae6b44b329c.css"
    integrity="sha512-Z&#43;sL77H7V&#43;ZShoTzov9uBgaoIQBQRwW2ZIjVSp8/2pwmBcm/O3AWMghCcohjentNGhaDhMERXkF0WOrmtEsynA==" />
  
  
  <script type="text/javascript" src="/github.io/js/appearance.min.516a16745bea5a9bd011138d254cc0fd3973cd55ce6e15f3dec763e7c7c2c7448f8fe7b54cca811cb821b0c7e12cd161caace1dd794ac3d34d40937cbcc9ee12.js"
    integrity="sha512-UWoWdFvqWpvQERONJUzA/TlzzVXObhXz3sdj58fCx0SPj&#43;e1TMqBHLghsMfhLNFhyqzh3XlKw9NNQJN8vMnuEg=="></script>
  
  
  
  
  
  
  
  
  
  
  
  <script defer type="text/javascript" id="script-bundle" src="/github.io/js/main.bundle.min.a5312a15393b6da77a379acf5b55576cabc85cb09cf0973d143812be82d0810982674c92e8564f3999e456d97305ae6f6269c41612d008359d8b94265a99eec5.js"
    integrity="sha512-pTEqFTk7bad6N5rPW1VXbKvIXLCc8Jc9FDgSvoLQgQmCZ0yS6FZPOZnkVtlzBa5vYmnEFhLQCDWdi5QmWpnuxQ==" data-copy="" data-copied=""></script>
  
  
  
  <script src="/github.io/lib/zoom/zoom.min.37d2094687372da3f7343a221a470f6b8806f7891aa46a5a03966af7f0ebd38b9fe536cb154e6ad28f006d184b294525a7c4054b6bbb4be62d8b453b42db99bd.js" integrity="sha512-N9IJRoc3LaP3NDoiGkcPa4gG94kapGpaA5Zq9/Dr04uf5TbLFU5q0o8AbRhLKUUlp8QFS2u7S&#43;Yti0U7QtuZvQ=="></script>
  
  
  
  <link rel="apple-touch-icon" sizes="180x180" href="/github.io/apple-touch-icon.png" />
  <link rel="icon" type="image/png" sizes="32x32" href="/github.io/favicon-32x32.png" />
  <link rel="icon" type="image/png" sizes="16x16" href="/github.io/favicon-16x16.png" />
  <link rel="manifest" href="/github.io/site.webmanifest" />
  
  
  
  
  
  
  
  <meta property="og:url" content="http://localhost:1313/github.io/writeups/0xgame2023_crypto/">
  <meta property="og:site_name" content="1n1t-Flare Blog">
  <meta property="og:title" content="0xGame2023 Crypto">
  <meta property="og:description" content="crypto writeup of 0xgame2023">
  <meta property="og:locale" content="zh_cn">
  <meta property="og:type" content="article">
    <meta property="article:section" content="writeups">
    <meta property="article:published_time" content="2024-01-01T00:00:00+00:00">
    <meta property="article:modified_time" content="2024-01-01T00:00:00+00:00">
    <meta property="article:tag" content="CTF">
    <meta property="article:tag" content="Crypto">

  
  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="0xGame2023 Crypto">
  <meta name="twitter:description" content="crypto writeup of 0xgame2023">

  
  <script type="application/ld+json">
  [{
    "@context": "https://schema.org",
    "@type": "Article",
    "articleSection": "Writeups",
    "name": "0xGame2023 Crypto",
    "headline": "0xGame2023 Crypto",
    
    "abstract": "crypto writeup of 0xgame2023",
    "inLanguage": "zh-cn",
    "url" : "http:\/\/localhost:1313\/github.io\/writeups\/0xgame2023_crypto\/",
    "author" : {
      "@type": "Person",
      "name": "1n1t"
    },
    "copyrightYear": "2024",
    "dateCreated": "2024-01-01T00:00:00\u002b00:00",
    "datePublished": "2024-01-01T00:00:00\u002b00:00",
    
    "dateModified": "2024-01-01T00:00:00\u002b00:00",
    
    "keywords": ["CTF","Crypto"],
    
    "mainEntityOfPage": "true",
    "wordCount": "1338"
  }]
  </script>


  
  
  <meta name="author" content="1n1t" />
  
  
  
  <link href="https://github.com/1n1t-Flare/" rel="me" />
  
  
  
  

<script src="/github.io/lib/jquery/jquery.slim.min.b0dca576e87d7eaa5850ae4e61759c065786cdb6489d68fcc82240539eebd5da522bdb4fda085ffd245808c8fe2acb2516408eb774ef26b5f6015fc6737c0ea8.js" integrity="sha512-sNylduh9fqpYUK5OYXWcBleGzbZInWj8yCJAU57r1dpSK9tP2ghf/SRYCMj&#43;KsslFkCOt3TvJrX2AV/Gc3wOqA=="></script>











<link type="text/css" rel="stylesheet" href="/github.io/lib/katex/katex.min.68e17230ccd917b97b7a2def38a8108918599d8aa4f580bfb8cce5e13d23e4de43dcaba5f9000553cb2c10d0d1300aabfe5c433a3305ebd752609f0762a63e59.css" integrity="sha512-aOFyMMzZF7l7ei3vOKgQiRhZnYqk9YC/uMzl4T0j5N5D3Kul&#43;QAFU8ssENDRMAqr/lxDOjMF69dSYJ8HYqY&#43;WQ==" />


<script defer src="/github.io/lib/katex/katex.min.50f14e69d6a8da7128ae3b63974c544ed377c36d096b5e3750f114e84c89d668b9301d9b0ed3248969aa183aa2e3bc4d2c1e73d5dcb7d462890c45a18d424589.js" integrity="sha512-UPFOadao2nEorjtjl0xUTtN3w20Ja143UPEU6EyJ1mi5MB2bDtMkiWmqGDqi47xNLB5z1dy31GKJDEWhjUJFiQ=="></script>


<script defer src="/github.io/lib/katex/auto-render.min.6095714e3aadb63b14ddc4af69346ab12974c1b460654345f8d1860a0b68fcc51b22f68b757433193090bb80afc8965b65cb607e5541d0f5f0f4b2e64d69b9ff.js" integrity="sha512-YJVxTjqttjsU3cSvaTRqsSl0wbRgZUNF&#43;NGGCgto/MUbIvaLdXQzGTCQu4CvyJZbZctgflVB0PXw9LLmTWm5/w=="
  onload="renderMathInElement(document.body);"></script>








































































































































  
  



  
  
  <meta name="theme-color"/>
  
  
</head>
<body
  class="flex flex-col h-screen px-6 m-auto text-lg leading-7 max-w-7xl bg-neutral text-neutral-900 dark:bg-neutral-800 dark:text-neutral sm:px-14 md:px-24 lg:px-32 scrollbar-thin scrollbar-track-neutral-200 scrollbar-thumb-neutral-400 dark:scrollbar-track-neutral-800 dark:scrollbar-thumb-neutral-600">
  <div id="the-top" class="absolute flex self-center">
    <a class="px-3 py-1 text-sm -translate-y-8 rounded-b-lg bg-primary-200 focus:translate-y-0 dark:bg-neutral-600"
      href="#main-content"><span
        class="font-bold text-primary-600 ltr:pr-2 rtl:pl-2 dark:text-primary-400">&darr;</span>跳过正文</a>
  </div>
  
  
  <div class="min-h-[148px]"></div>
<div class="fixed inset-x-0 pl-[24px] pr-[24px]" style="z-index:100">
  <div id="menu-blur" class="absolute opacity-0 inset-x-0 top-0 h-full single_hero_background nozoom bg-neutral dark:bg-neutral-800"></div>
  <div class="relative max-w-[64rem] ml-auto mr-auto">
    <div style="padding-left:0;padding-right:0;padding-top:2px;padding-bottom:3px"
    class="main-menu flex items-center justify-between px-4 py-6 sm:px-6 md:justify-start space-x-3">
    
    
    
    <div>
        <a href="/github.io/" class="flex">
            <span class="sr-only">1n1t-Flare Blog</span>

            
            <img src="/github.io/img/blowfish_logo_transparent.png" width="1000" height="1000"
                class="logo max-h-[5rem] max-w-[5rem] object-scale-down object-left nozoom" alt="1n1t-Flare Blog" />
            

        </a>
    </div>
    
    <div class="flex flex-1 items-center justify-between">
        <nav class="flex space-x-3">

            
            <a href="/github.io/" class="text-base font-medium text-gray-500 hover:text-gray-900">1n1t-Flare Blog</a>
            

        </nav>
        <nav class="hidden md:flex items-center space-x-5 md:ml-12 h-12">

            
            
            
  <a href="/github.io/writeups/"  class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400">
    
    <p class="text-base font-medium" title="">
        WriteUps
    </p>
</a>



            
            
  <a href="/github.io/docs/"  class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400">
    
    <p class="text-base font-medium" title="">
        Docs
    </p>
</a>



            
            
  <a href="/github.io/tags/"  class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400">
    
    <p class="text-base font-medium" title="">
        Tags
    </p>
</a>



            
            
  <a href="https://github.com/nunocoracao/blowfish"  target="_blank"  class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400">
    
    <span >
        

  <span class="relative block icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><path fill="currentColor" d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>

  </span>


    </span>
    
    <p class="text-base font-medium" title="">
        
    </p>
</a>



            
            

            


            
            <button id="search-button" aria-label="Search" class="text-base hover:text-primary-600 dark:hover:text-primary-400"
                title="">
                

  <span class="relative block icon">
    <svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="search" class="svg-inline--fa fa-search fa-w-16" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M505 442.7L405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9 0 208 0S0 93.1 0 208s93.1 208 208 208c48.3 0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9 0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7 0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7 0 128 57.2 128 128 0 70.7-57.2 128-128 128z"/></svg>

  </span>


            </button>
            


            
            
            <div
                class="ltr:mr-14 rtl:ml-14 flex items-center">
                <button id="appearance-switcher" aria-label="Dark mode switcher" type="button" class="text-base hover:text-primary-600 dark:hover:text-primary-400">
                    <div class="flex items-center justify-center dark:hidden">
                        

  <span class="relative block icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M32 256c0-123.8 100.3-224 223.8-224c11.36 0 29.7 1.668 40.9 3.746c9.616 1.777 11.75 14.63 3.279 19.44C245 86.5 211.2 144.6 211.2 207.8c0 109.7 99.71 193 208.3 172.3c9.561-1.805 16.28 9.324 10.11 16.95C387.9 448.6 324.8 480 255.8 480C132.1 480 32 379.6 32 256z"/></svg>

  </span>


                    </div>
                    <div class="items-center justify-center hidden dark:flex">
                        

  <span class="relative block icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M256 159.1c-53.02 0-95.1 42.98-95.1 95.1S202.1 351.1 256 351.1s95.1-42.98 95.1-95.1S309 159.1 256 159.1zM509.3 347L446.1 255.1l63.15-91.01c6.332-9.125 1.104-21.74-9.826-23.72l-109-19.7l-19.7-109c-1.975-10.93-14.59-16.16-23.72-9.824L256 65.89L164.1 2.736c-9.125-6.332-21.74-1.107-23.72 9.824L121.6 121.6L12.56 141.3C1.633 143.2-3.596 155.9 2.736 164.1L65.89 256l-63.15 91.01c-6.332 9.125-1.105 21.74 9.824 23.72l109 19.7l19.7 109c1.975 10.93 14.59 16.16 23.72 9.824L256 446.1l91.01 63.15c9.127 6.334 21.75 1.107 23.72-9.822l19.7-109l109-19.7C510.4 368.8 515.6 356.1 509.3 347zM256 383.1c-70.69 0-127.1-57.31-127.1-127.1c0-70.69 57.31-127.1 127.1-127.1s127.1 57.3 127.1 127.1C383.1 326.7 326.7 383.1 256 383.1z"/></svg>

  </span>


                    </div>
                </button>
            </div>
            

        </nav>
        <div class="flex md:hidden items-center space-x-5 md:ml-12 h-12">

            <span></span>

            


            
            <button id="search-button-mobile" aria-label="Search" class="text-base hover:text-primary-600 dark:hover:text-primary-400"
                title="">
                

  <span class="relative block icon">
    <svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="search" class="svg-inline--fa fa-search fa-w-16" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M505 442.7L405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9 0 208 0S0 93.1 0 208s93.1 208 208 208c48.3 0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9 0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7 0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7 0 128 57.2 128 128 0 70.7-57.2 128-128 128z"/></svg>

  </span>


            </button>
            

            
            
            <button id="appearance-switcher-mobile" aria-label="Dark mode switcher" type="button" class="text-base hover:text-primary-600 dark:hover:text-primary-400" style="margin-right:5px">
                <div class="flex items-center justify-center dark:hidden">
                    

  <span class="relative block icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M32 256c0-123.8 100.3-224 223.8-224c11.36 0 29.7 1.668 40.9 3.746c9.616 1.777 11.75 14.63 3.279 19.44C245 86.5 211.2 144.6 211.2 207.8c0 109.7 99.71 193 208.3 172.3c9.561-1.805 16.28 9.324 10.11 16.95C387.9 448.6 324.8 480 255.8 480C132.1 480 32 379.6 32 256z"/></svg>

  </span>


                </div>
                <div class="items-center justify-center hidden dark:flex">
                    

  <span class="relative block icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M256 159.1c-53.02 0-95.1 42.98-95.1 95.1S202.1 351.1 256 351.1s95.1-42.98 95.1-95.1S309 159.1 256 159.1zM509.3 347L446.1 255.1l63.15-91.01c6.332-9.125 1.104-21.74-9.826-23.72l-109-19.7l-19.7-109c-1.975-10.93-14.59-16.16-23.72-9.824L256 65.89L164.1 2.736c-9.125-6.332-21.74-1.107-23.72 9.824L121.6 121.6L12.56 141.3C1.633 143.2-3.596 155.9 2.736 164.1L65.89 256l-63.15 91.01c-6.332 9.125-1.105 21.74 9.824 23.72l109 19.7l19.7 109c1.975 10.93 14.59 16.16 23.72 9.824L256 446.1l91.01 63.15c9.127 6.334 21.75 1.107 23.72-9.822l19.7-109l109-19.7C510.4 368.8 515.6 356.1 509.3 347zM256 383.1c-70.69 0-127.1-57.31-127.1-127.1c0-70.69 57.31-127.1 127.1-127.1s127.1 57.3 127.1 127.1C383.1 326.7 326.7 383.1 256 383.1z"/></svg>

  </span>


                </div>
            </button>
            

        </div>
    </div>
    <div class="-my-2 -mr-2 md:hidden">

        <label id="menu-button" class="block">
            
            <div class="cursor-pointer hover:text-primary-600 dark:hover:text-primary-400">
                

  <span class="relative block icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentColor" d="M0 96C0 78.33 14.33 64 32 64H416C433.7 64 448 78.33 448 96C448 113.7 433.7 128 416 128H32C14.33 128 0 113.7 0 96zM0 256C0 238.3 14.33 224 32 224H416C433.7 224 448 238.3 448 256C448 273.7 433.7 288 416 288H32C14.33 288 0 273.7 0 256zM416 448H32C14.33 448 0 433.7 0 416C0 398.3 14.33 384 32 384H416C433.7 384 448 398.3 448 416C448 433.7 433.7 448 416 448z"/></svg>

  </span>


            </div>
            <div id="menu-wrapper" style="padding-top:5px;"
                class="fixed inset-0 z-30 invisible w-screen h-screen m-0 overflow-auto transition-opacity opacity-0 cursor-default bg-neutral-100/50 backdrop-blur-sm dark:bg-neutral-900/50">
                <ul
                    class="flex space-y-2 mt-3 flex-col items-end w-full px-6 py-6 mx-auto overflow-visible list-none ltr:text-right rtl:text-left max-w-7xl">

                    <li id="menu-close-button">
                        <span
                            class="cursor-pointer inline-block align-text-bottom hover:text-primary-600 dark:hover:text-primary-400">

  <span class="relative block icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><path fill="currentColor" d="M310.6 361.4c12.5 12.5 12.5 32.75 0 45.25C304.4 412.9 296.2 416 288 416s-16.38-3.125-22.62-9.375L160 301.3L54.63 406.6C48.38 412.9 40.19 416 32 416S15.63 412.9 9.375 406.6c-12.5-12.5-12.5-32.75 0-45.25l105.4-105.4L9.375 150.6c-12.5-12.5-12.5-32.75 0-45.25s32.75-12.5 45.25 0L160 210.8l105.4-105.4c12.5-12.5 32.75-12.5 45.25 0s12.5 32.75 0 45.25l-105.4 105.4L310.6 361.4z"/></svg>

  </span>

</span>
                    </li>

                    

                    
  <li class="mt-1">
    <a href="/github.io/writeups/"  class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400">
        
        <p class="text-bg font-bg" title="">
            WriteUps
        </p>
    </a>
</li>




                    

                    
  <li class="mt-1">
    <a href="/github.io/docs/"  class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400">
        
        <p class="text-bg font-bg" title="">
            Docs
        </p>
    </a>
</li>




                    

                    
  <li class="mt-1">
    <a href="/github.io/tags/"  class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400">
        
        <p class="text-bg font-bg" title="">
            Tags
        </p>
    </a>
</li>




                    

                    
  <li class="mt-1">
    <a href="https://github.com/nunocoracao/blowfish"  target="_blank"  class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400">
        
        <div >
            

  <span class="relative block icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><path fill="currentColor" d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>

  </span>


        </div>
        
        <p class="text-bg font-bg" title="">
            
        </p>
    </a>
</li>




                    

                </ul>
                
                

            </div>
        </label>
    </div>
</div>




<script>
    (function () {
        var $mainmenu = $('.main-menu');
        var path = window.location.pathname;
        $mainmenu.find('a[href="' + path + '"]').each(function (i, e) {
            $(e).children('p').addClass('active');
        });
    })();
</script>


  </div>
</div>
<script>
  window.addEventListener('scroll', function (e) {
    var scroll = window.pageYOffset || document.documentElement.scrollTop || document.body.scrollTop || 0;
    var background_blur = document.getElementById('menu-blur');
    background_blur.style.opacity = (scroll / 300);
  });
</script>

  
  <div class="relative flex flex-col grow">
    <main id="main-content" class="grow">
      


<article>
  

  <header id="single_header" class="mt-5 max-w-prose">
    
    <ol class="text-sm text-neutral-500 dark:text-neutral-400 print:hidden">
  
  
    
  
    
  
  <li class="inline hidden">
    <a
      class="hover:underline decoration-neutral-300 dark:underline-neutral-600"
      href="/github.io/"
      >1n1t-Flare Blog</a
    ><span class="px-1 text-primary-500">/</span>
  </li>

  
  <li class="inline ">
    <a
      class="hover:underline decoration-neutral-300 dark:underline-neutral-600"
      href="/github.io/writeups/"
      >Writeups</a
    ><span class="px-1 text-primary-500">/</span>
  </li>

  
  <li class="inline hidden">
    <a
      class="hover:underline decoration-neutral-300 dark:underline-neutral-600"
      href="/github.io/writeups/0xgame2023_crypto/"
      >0xGame2023 Crypto</a
    ><span class="px-1 text-primary-500">/</span>
  </li>

</ol>


    
    <h1 class="mt-0 text-4xl font-extrabold text-neutral-900 dark:text-neutral">
      0xGame2023 Crypto
    </h1>
    <div class="mt-1 mb-6 text-base text-neutral-500 dark:text-neutral-400 print:hidden">
      





  
  







  





  



  











  



<div class="flex flex-row flex-wrap items-center">
  
  
  <time datetime="2024-01-01T00:00:00&#43;00:00">2024-01-01</time><span class="px-2 text-primary-500">&middot;</span><span>1338 字</span><span class="px-2 text-primary-500">&middot;</span><span title="预计阅读">7 分钟</span><span class="px-2 text-primary-500">&middot;</span>


<script type="text/javascript" src="/github.io/js/zen-mode.min.63c8a202661f4a2063fdc2706685d668e8ea3da613da2224e9da527e5876e4f53dcac39ab60732626fb4151feae5d430d0cf44731e5d3c726522fcc1519c1547.js" integrity="sha512-Y8iiAmYfSiBj/cJwZoXWaOjqPaYT2iIk6dpSflh25PU9ysOatgcyYm&#43;0FR/q5dQw0M9Ecx5dPHJlIvzBUZwVRw=="></script>

<span class="mb-[2px]">
    <span id="zen-mode-button"
          class="text-lg hover:text-primary-500"
          title=""
          data-title-i18n-disable=""
          data-title-i18n-enable="">
        <span class="inline-block align-text-bottom">

  <span class="relative block icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 50 50" width="50px" height="50px">
    <path fill="currentColor" d="M 12.980469 4 C 9.1204688 4 5.9804688 7.14 5.9804688 11 L 6 26 L 9.9804688 26 L 9.9804688 11 C 9.9804688 9.35 11.320469 8 12.980469 8 L 40.019531 8 C 41.679531 8 43.019531 9.35 43.019531 11 L 43.019531 39 C 43.019531 40.65 41.679531 42 40.019531 42 L 29 42 C 29 43.54 28.420938 44.94 27.460938 46 L 40.019531 46 C 43.879531 46 47.019531 42.86 47.019531 39 L 47.019531 11 C 47.019531 7.14 43.879531 4 40.019531 4 L 12.980469 4 z M 7 28 C 4.794 28 3 29.794 3 32 L 3 42 C 3 44.206 4.794 46 7 46 L 23 46 C 25.206 46 27 44.206 27 42 L 27 32 C 27 29.794 25.206 28 23 28 L 7 28 z M 7 32 L 23 32 L 23.001953 42 L 7 42 L 7 32 z"/>
</svg>
  </span>

</span>
    </span>
</span>
  

  
  
</div>





<div class="flex flex-row flex-wrap items-center">
  
  
  
  
  
  
  
  
  
  
  
  
  <span style="margin-top:0.5rem" class="mr-2" onclick="window.open(&#34;/github.io/tags/ctf/&#34;,'_self');">
    <span class="flex" style="cursor: pointer;">
  <span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">
    CTF
  </span>
</span>
  </span>
  
  <span style="margin-top:0.5rem" class="mr-2" onclick="window.open(&#34;/github.io/tags/crypto/&#34;,'_self');">
    <span class="flex" style="cursor: pointer;">
  <span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">
    Crypto
  </span>
</span>
  </span>
  
  
  
  
</div>




    </div>

    
    
    
    
    

    

    
      
      

      

      

    

  </header>
  
  <section class="flex flex-col max-w-full mt-0 prose dark:prose-invert lg:flex-row">
    
     <div
      class="order-first lg:ml-auto px-0 lg:order-last ltr:lg:pl-8 rtl:lg:pr-8">
      <div class="toc ltr:pl-5 rtl:pr-5 print:hidden lg:sticky lg:top-[140px]">

         <details open id="TOCView"
  class="toc-right mt-0 overflow-y-scroll overscroll-contain scrollbar-thin scrollbar-track-neutral-200 scrollbar-thumb-neutral-400 dark:scrollbar-track-neutral-800 dark:scrollbar-thumb-neutral-600 rounded-lg ltr:-ml-5 ltr:pl-5 rtl:-mr-5 rtl:pr-5 hidden lg:block">
  <summary
    class="block py-1 text-lg font-semibold cursor-pointer bg-neutral-100 text-neutral-800 ltr:-ml-5 ltr:pl-5 rtl:-mr-5 rtl:pr-5 dark:bg-neutral-700 dark:text-neutral-100 lg:hidden">
    目录
  </summary>
  <div
    class="min-w-[220px] py-2 border-dotted ltr:-ml-5 ltr:border-l ltr:pl-5 rtl:-mr-5 rtl:border-r rtl:pr-5 dark:border-neutral-600">
    <nav id="TableOfContents">
  <ul>
    <li><a href="#week1">Week1</a>
      <ul>
        <li><a href="#whats-cbc">What&rsquo;s CBC?</a></li>
        <li><a href="#密码觅码先有再密">密码，觅码，先有*再密</a></li>
        <li><a href="#take-my-bag">Take my bag!</a></li>
        <li><a href="#babyrsa">BabyRSA</a></li>
        <li><a href="#猜谜">猜谜</a></li>
        <li><a href="#vigenere">Vigenere</a></li>
      </ul>
    </li>
    <li><a href="#week2">Week2</a>
      <ul>
        <li><a href="#ezlfsr">EzLFSR</a></li>
        <li><a href="#中间的那个人">中间的那个人</a></li>
      </ul>
    </li>
    <li><a href="#week3">Week3</a>
      <ul>
        <li><a href="#ezecc">EzECC</a></li>
        <li><a href="#lll-firstblood">LLL-FirstBlood</a></li>
        <li><a href="#lll-secondblood">LLL-SecondBlood</a></li>
      </ul>
    </li>
    <li><a href="#week4">Week4</a>
      <ul>
        <li><a href="#normal-ecc">Normal ECC</a></li>
      </ul>
    </li>
  </ul>
</nav>
  </div>
</details>
<details class="toc-inside mt-0 overflow-hidden rounded-lg ltr:-ml-5 ltr:pl-5 rtl:-mr-5 rtl:pr-5 lg:hidden">
  <summary
    class="py-1 text-lg font-semibold cursor-pointer bg-neutral-100 text-neutral-800 ltr:-ml-5 ltr:pl-5 rtl:-mr-5 rtl:pr-5 dark:bg-neutral-700 dark:text-neutral-100 lg:hidden">
    目录
  </summary>
  <div
    class="py-2 border-dotted border-neutral-300 ltr:-ml-5 ltr:border-l ltr:pl-5 rtl:-mr-5 rtl:border-r rtl:pr-5 dark:border-neutral-600">
    <nav id="TableOfContents">
  <ul>
    <li><a href="#week1">Week1</a>
      <ul>
        <li><a href="#whats-cbc">What&rsquo;s CBC?</a></li>
        <li><a href="#密码觅码先有再密">密码，觅码，先有*再密</a></li>
        <li><a href="#take-my-bag">Take my bag!</a></li>
        <li><a href="#babyrsa">BabyRSA</a></li>
        <li><a href="#猜谜">猜谜</a></li>
        <li><a href="#vigenere">Vigenere</a></li>
      </ul>
    </li>
    <li><a href="#week2">Week2</a>
      <ul>
        <li><a href="#ezlfsr">EzLFSR</a></li>
        <li><a href="#中间的那个人">中间的那个人</a></li>
      </ul>
    </li>
    <li><a href="#week3">Week3</a>
      <ul>
        <li><a href="#ezecc">EzECC</a></li>
        <li><a href="#lll-firstblood">LLL-FirstBlood</a></li>
        <li><a href="#lll-secondblood">LLL-SecondBlood</a></li>
      </ul>
    </li>
    <li><a href="#week4">Week4</a>
      <ul>
        <li><a href="#normal-ecc">Normal ECC</a></li>
      </ul>
    </li>
  </ul>
</nav>
  </div>
</details>

<script>

  var margin = 200;
  var marginError = 50;

  (function () {
    var $window = $(window);
    var $toc = $('#TOCView');
    var tocHeight = $toc.height();

    function onResize() {
      var windowAndMarginHeight = $window.height() - margin;
      if(tocHeight >= windowAndMarginHeight) {
        $toc.css("overflow-y", "scroll")
        $toc.css("max-height", (windowAndMarginHeight + marginError) + "px")
      } else {
        $toc.css("overflow-y", "hidden")
        $toc.css("max-height", "9999999px")
      }
    }

    $window.on('resize', onResize);
    $(document).ready(onResize);
  })();



  (function () {
    var $toc = $('#TableOfContents');
    if ($toc.length > 0) {
      var $window = $(window);

      function onScroll() {
        var currentScroll = $window.scrollTop();
        var h = $('.anchor');
        var id = "";
        h.each(function (i, e) {
          e = $(e);
          if (e.offset().top - $(window).height()/3 <= currentScroll) {
            id = decodeURIComponent(e.attr('id'));
          }
        });
        var active = $toc.find('a.active');      
        if (active.length == 1 && active.eq(0).attr('href') == '#' + id) return true;

        active.each(function (i, e) {
           
            $(e).removeClass('active').siblings('ul').hide();
          
        });
        $toc.find('a[href="#' + id + '"]').addClass('active')
        $toc.find('a[href="#' + id + '"]').parentsUntil('#TableOfContents').each(function (i, e) {
          $(e).children('a').parents('ul').show();          
        });
      }

      $window.on('scroll', onScroll);
      $(document).ready(function () {
         
          $toc.find('a').parent('li').find('ul').hide();
        
        onScroll();
      });
    }
  })();


</script>
   </div>
      </div>
      

      <div class="min-w-0 min-h-0 max-w-fit">
        
        


        <div class="article-content max-w-prose mb-20">
          



<h2 class="relative group">Week1 
    <div id="week1" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#week1" aria-label="锚点">#</a>
    </span>        
    
</h2>


<h3 class="relative group">What&rsquo;s CBC? 
    <div id="whats-cbc" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#whats-cbc" aria-label="锚点">#</a>
    </span>        
    
</h3>
<p>查询资料知CBC是一种分组加密算法。把明文分为等长的几组，用初始化向量对第一组明文进行xor运算，再进行另一种加密得到第一组密文。接下来用第一组密文作为向量加密第二组明文……依次类推。</p>
<p>注意到xor运算(⊕)的特殊性质：
$$
A⊕0=A
$$</p>
<p>$$
A⊕A=0
$$</p>
<p>如果两数xor后，对结果再xor这两个数中的一个，可以得到其中另一个数。
$$
(A⊕B)⊕B=A⊕(B⊕B)=A⊕0=A
$$
这样一来，解密就方便很多。但是最后的加密函数<code>encrypt()</code>中出现了未知的密钥key，所以首先要解出key。</p>
<p>
    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        srcset="
        /github.io/writeups/0xgame2023_crypto/image-20231007230516072_hu15837423664018636468.png 330w,
        /github.io/writeups/0xgame2023_crypto/image-20231007230516072_hu17840598928125039146.png 660w,
        /github.io/writeups/0xgame2023_crypto/image-20231007230516072_hu1230411184601191968.png 1024w,
        /github.io/writeups/0xgame2023_crypto/image-20231007230516072_hu9517744920263162927.png 2x"
        src="/github.io/writeups/0xgame2023_crypto/image-20231007230516072_hu17840598928125039146.png"
        alt="image-20231007230516072"
      />
      
    </figure>
</p>
<p>从<code> i ^ key</code> 推测<code>key</code>是一个数而非<code>bytes</code>类型，而且对每一个<code>i</code>都进行了异或运算，理论上只要知道一个<code>i</code>就可以反推出来 (<code>i ^ key ^i</code>) 。我们已知flag的前七位是标准的 <code>'0xGame{' </code>格式，题中每组明文或密文均为八位，于是再随便补一个字母凑成第一组明文，与iv异或后推<code>key</code>。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">Crypto.Util.number</span> <span class="kn">import</span> <span class="o">*</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">f</span><span class="o">=</span><span class="sa">b</span><span class="s1">&#39;0xGame{a&#39;</span>
</span></span><span class="line"><span class="cl"><span class="n">iv</span> <span class="o">=</span> <span class="sa">b</span><span class="s1">&#39;11111111&#39;</span>
</span></span><span class="line"><span class="cl"><span class="n">enc</span><span class="o">=</span><span class="sa">b</span><span class="s2">&#34;</span><span class="se">\x8e\xc6\xf9\xdf\xd3\xdb\xc5\x8e</span><span class="s2">8q</span><span class="se">\x10</span><span class="s2">f&gt;7.5</span><span class="se">\x81\xcc\xae\x8d\x82\x8f\x92\xd9</span><span class="s2">o&#39;D6h8.d</span><span class="se">\xd6\x9a\xfc\xdb\xd3\xd1\x97\x96</span><span class="s2">Q</span><span class="se">\x1d</span><span class="s2">{</span><span class="se">\\</span><span class="s2">TV</span><span class="se">\x10\x11</span><span class="s2">&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">bytes_xor</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">	<span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="o">=</span><span class="n">bytes_to_long</span><span class="p">(</span><span class="n">a</span><span class="p">),</span><span class="n">bytes_to_long</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="k">return</span> <span class="n">long_to_bytes</span><span class="p">(</span><span class="n">a</span><span class="o">^</span><span class="n">b</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">k</span><span class="o">=</span><span class="n">bytes_xor</span><span class="p">(</span><span class="n">f</span><span class="p">,</span><span class="n">iv</span><span class="p">)</span>   
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">8</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">  <span class="n">key</span><span class="o">=</span><span class="n">enc</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">^</span><span class="n">k</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">  <span class="nb">print</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl"><span class="s1">&#39;&#39;&#39;
</span></span></span><span class="line"><span class="cl"><span class="s1">143
</span></span></span><span class="line"><span class="cl"><span class="s1">143
</span></span></span><span class="line"><span class="cl"><span class="s1">143
</span></span></span><span class="line"><span class="cl"><span class="s1">143
</span></span></span><span class="line"><span class="cl"><span class="s1">143
</span></span></span><span class="line"><span class="cl"><span class="s1">143
</span></span></span><span class="line"><span class="cl"><span class="s1">143
</span></span></span><span class="line"><span class="cl"><span class="s1">222
</span></span></span><span class="line"><span class="cl"><span class="s1">&#39;&#39;&#39;</span>
</span></span></code></pre></div><p>忽略掉最后随便找的那个字母(222那个)，能得到key=143。利用xor的性质写出<code>decrypt</code>, <code>Decrypt_CbC</code>两个解密函数(与题目中的两个加密函数相对应，甚至几乎一样)，代入数据解出flag。</p>
<p>
    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        srcset="
        /github.io/writeups/0xgame2023_crypto/image-20231007201315198_hu3143520918713400145.png 330w,
        /github.io/writeups/0xgame2023_crypto/image-20231007201315198_hu4536339333551522133.png 660w,
        /github.io/writeups/0xgame2023_crypto/image-20231007201315198_hu16806383609259098381.png 1024w,
        /github.io/writeups/0xgame2023_crypto/image-20231007201315198_hu16407289329035695166.png 2x"
        src="/github.io/writeups/0xgame2023_crypto/image-20231007201315198_hu4536339333551522133.png"
        alt="image-20231007201315198"
      />
      
    </figure>
</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">Crypto.Util.number</span> <span class="kn">import</span> <span class="o">*</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">bytes_xor</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">	<span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="o">=</span><span class="n">bytes_to_long</span><span class="p">(</span><span class="n">a</span><span class="p">),</span><span class="n">bytes_to_long</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="k">return</span> <span class="n">long_to_bytes</span><span class="p">(</span><span class="n">a</span><span class="o">^</span><span class="n">b</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">decrypt</span><span class="p">(</span><span class="n">enc</span><span class="p">,</span><span class="n">key</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">result</span><span class="o">=</span><span class="sa">b</span><span class="s1">&#39;&#39;</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">enc</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    	<span class="n">result</span> <span class="o">+=</span> <span class="p">((</span><span class="n">i</span><span class="o">^</span><span class="n">key</span><span class="p">))</span><span class="o">.</span><span class="n">to_bytes</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="s1">&#39;big&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">result</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">Decrypt_CbC</span><span class="p">(</span><span class="n">enc</span><span class="p">,</span><span class="n">iv</span><span class="p">,</span><span class="n">key</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">result</span><span class="o">=</span><span class="sa">b</span><span class="s1">&#39;&#39;</span>
</span></span><span class="line"><span class="cl">    <span class="n">block</span><span class="o">=</span><span class="p">[</span><span class="n">enc</span><span class="p">[</span><span class="n">k</span><span class="o">*</span><span class="mi">8</span><span class="p">:(</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="mi">8</span><span class="p">]</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">enc</span><span class="p">)</span><span class="o">//</span><span class="mi">8</span><span class="p">)]</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">block</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    	<span class="n">text</span> <span class="o">=</span> <span class="n">decrypt</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">key</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    	<span class="n">plain</span> <span class="o">=</span> <span class="n">bytes_xor</span><span class="p">(</span><span class="n">iv</span><span class="p">,</span><span class="n">text</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		<span class="n">iv</span><span class="o">=</span><span class="n">i</span>
</span></span><span class="line"><span class="cl">    	<span class="n">result</span> <span class="o">+=</span> <span class="n">plain</span>
</span></span><span class="line"><span class="cl">	<span class="k">return</span> <span class="n">result</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">enc</span> <span class="o">=</span> <span class="sa">b</span><span class="s2">&#34;</span><span class="se">\x8e\xc6\xf9\xdf\xd3\xdb\xc5\x8e</span><span class="s2">8q</span><span class="se">\x10</span><span class="s2">f&gt;7.5</span><span class="se">\x81\xcc\xae\x8d\x82\x8f\x92\xd9</span><span class="s2">o&#39;D6h8.d</span><span class="se">\xd6\x9a\xfc\xdb\xd3\xd1\x97\x96</span><span class="s2">Q</span><span class="se">\x1d</span><span class="s2">{</span><span class="se">\\</span><span class="s2">TV</span><span class="se">\x10\x11</span><span class="s2">&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">iv</span> <span class="o">=</span> <span class="sa">b</span><span class="s1">&#39;11111111&#39;</span>
</span></span><span class="line"><span class="cl"><span class="n">key</span> <span class="o">=</span> <span class="mi">143</span>
</span></span><span class="line"><span class="cl"><span class="n">flag</span> <span class="o">=</span> <span class="n">Decrypt_CbC</span><span class="p">(</span><span class="n">enc</span><span class="p">,</span><span class="n">iv</span><span class="p">,</span><span class="n">key</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">flag</span><span class="p">)</span>
</span></span></code></pre></div>

<h3 class="relative group">密码，觅码，先有*再密 
    <div id="%E5%AF%86%E7%A0%81%E8%A7%85%E7%A0%81%E5%85%88%E6%9C%89%E5%86%8D%E5%AF%86" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#%E5%AF%86%E7%A0%81%E8%A7%85%E7%A0%81%E5%85%88%E6%9C%89%E5%86%8D%E5%AF%86" aria-label="锚点">#</a>
    </span>        
    
</h3>
<p>把flag切成四份，每份用不同的方法加密。只要判断出每份是如何加密，逐个击破即可。</p>
<p>
    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        srcset="
        /github.io/writeups/0xgame2023_crypto/image-20231006143508458_hu3537529931550070423.png 330w,
        /github.io/writeups/0xgame2023_crypto/image-20231006143508458_hu14719451182304958610.png 660w,
        /github.io/writeups/0xgame2023_crypto/image-20231006143508458_hu11502886253550802834.png 1024w,
        /github.io/writeups/0xgame2023_crypto/image-20231006143508458_hu2908441355981621997.png 2x"
        src="/github.io/writeups/0xgame2023_crypto/image-20231006143508458_hu14719451182304958610.png"
        alt="image-20231006143508458"
      />
      
    </figure>
</p>
<ul>
<li>
<p><code>c1</code>：<code>Crypto.Util.number</code>中的<code>bytes_to_long()</code>函数，把bytes转化成整数，用对应的<code>long_to_bytes()</code>解密。但还有个小细节，<code>c1</code>输出时变成自身的5次方，我们需要开五次方根还原<code>c1</code>。这里如果用<code>pow(c1,0.2)</code>会有精度的问题，所以采用<code>gmpy2</code>模块的<code>iroot</code>函数</p>
</li>
<li>
<p><code>c2</code>：把bytes中每个字节取二进制并连在一起，解密时等距离拆分还原为<code>bytes</code></p>
</li>
<li>
<p><code>c3</code>：常见的base64编码，用对应的<code>b64decode()</code>函数</p>
</li>
<li>
<p><code>c4</code>：十六进制与bytes互化</p>
</li>
</ul>
<p>还有一个要注意的地方是flag内部是汉字，用<code>utf-8</code>解码</p>
<p>
    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        srcset="
        /github.io/writeups/0xgame2023_crypto/image-20231006143439687_hu4445117231859616789.png 330w,
        /github.io/writeups/0xgame2023_crypto/image-20231006143439687_hu11693059644014221189.png 660w,
        /github.io/writeups/0xgame2023_crypto/image-20231006143439687_hu13822535296249396768.png 1024w,
        /github.io/writeups/0xgame2023_crypto/image-20231006143439687_hu2047356528177931601.png 2x"
        src="/github.io/writeups/0xgame2023_crypto/image-20231006143439687_hu11693059644014221189.png"
        alt="image-20231006143439687"
      />
      
    </figure>
</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">base64</span> <span class="kn">import</span> <span class="n">b64decode</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">Crypto.Util.number</span> <span class="kn">import</span><span class="o">*</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">gmpy2</span> <span class="kn">import</span> <span class="n">iroot</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">c1a</span><span class="o">=</span><span class="mi">2607076237872456265701394408859286660368327415582106508683648834772020887801353062171214554351749058553609022833985773083200356284531601339221590756213276590896143894954053902973407638214851164171968630602313844022016135428560081844499356672695981757804756591891049233334352061975924028218309004551</span>
</span></span><span class="line"><span class="cl"><span class="n">c2</span><span class="o">=</span><span class="s1">&#39;10010000100001101110100010100111101000111110010010111010100001101110010010111111101000011110011010000001101011111110011010011000101011111110010110100110100000101110010010111101100101011110011110111100&#39;</span>
</span></span><span class="line"><span class="cl"><span class="n">c3</span> <span class="o">=</span> <span class="sa">b</span><span class="s1">&#39;lueggeeahO+8jOmCo+S5iOW8gOWni+aIkQ==&#39;</span>
</span></span><span class="line"><span class="cl"><span class="n">c4</span> <span class="o">=</span> <span class="s1">&#39;e4bbace79a8443727970746fe68c91e68898e590a72121217d&#39;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">c1</span> <span class="o">=</span> <span class="n">iroot</span><span class="p">(</span><span class="n">c1a</span><span class="p">,</span><span class="mi">5</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">f1</span> <span class="o">=</span> <span class="n">long_to_bytes</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">c1</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
</span></span><span class="line"><span class="cl"><span class="n">f</span> <span class="o">=</span> <span class="p">[</span><span class="n">c2</span><span class="p">[</span><span class="n">i</span><span class="o">*</span><span class="mi">8</span><span class="p">:(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="mi">8</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">c2</span><span class="p">)</span><span class="o">//</span><span class="mi">8</span><span class="p">)]</span>
</span></span><span class="line"><span class="cl"><span class="n">f2</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">hex</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="s1">&#39;0b&#39;</span><span class="o">+</span><span class="n">k</span><span class="p">,</span><span class="n">base</span><span class="o">=</span><span class="mi">0</span><span class="p">))[</span><span class="mi">2</span><span class="p">:]</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">f</span><span class="p">])</span>
</span></span><span class="line"><span class="cl"><span class="n">f2</span><span class="o">=</span><span class="nb">bytes</span><span class="o">.</span><span class="n">fromhex</span><span class="p">(</span><span class="n">f2</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">f3</span> <span class="o">=</span> <span class="n">b64decode</span><span class="p">(</span><span class="n">c3</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">f4</span><span class="o">=</span><span class="nb">bytes</span><span class="o">.</span><span class="n">fromhex</span><span class="p">(</span><span class="n">c4</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">flag</span><span class="o">=</span><span class="p">(</span><span class="n">f1</span><span class="o">+</span><span class="n">f2</span><span class="o">+</span><span class="n">f3</span><span class="o">+</span><span class="n">f4</span><span class="p">)</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">flag</span><span class="p">)</span>
</span></span></code></pre></div>

<h3 class="relative group">Take my bag! 
    <div id="take-my-bag" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#take-my-bag" aria-label="锚点">#</a>
    </span>        
    
</h3>
<blockquote>
<p>赛后复现补充：背包dp，动态规划，这下真手撕算法了orz</p>
</blockquote>
<p>没看出是什么加密，也没找到标准的解密方式，就当成算法题做了。</p>
<p>分析一下我的思路：</p>
<p>
    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        srcset="
        /github.io/writeups/0xgame2023_crypto/image-20231008123925612_hu14563578872749360333.png 330w,
        /github.io/writeups/0xgame2023_crypto/image-20231008123925612_hu6755904225163918061.png 660w,
        /github.io/writeups/0xgame2023_crypto/image-20231008123925612_hu4329252874400713401.png 1024w,
        /github.io/writeups/0xgame2023_crypto/image-20231008123925612_hu14948886274713889860.png 2x"
        src="/github.io/writeups/0xgame2023_crypto/image-20231008123925612_hu6755904225163918061.png"
        alt="image-20231008123925612"
      />
      
    </figure>
</p>
<p>题中的加密函数把明文转为二进制并逆序处理，<code>init</code>是给出的一个数表，关键在<code>init[i] * int(m[i]) % n</code>这个表达式。我们知道二进制中只会出现0和1，相应地，表达式也只会出现两种结果：</p>
<ol>
<li>
<p><code>int(m[i]) = 0</code>，表达式等于0</p>
</li>
<li>
<p><code>int(m[i]) = 1，init[i] * int(m[i]) % n = init[i] % n</code>，而<code>init</code>中元素已经对n取过模，不会大于n。故表达式等于<code>init[i]</code></p>
</li>
</ol>
<p>即密文c是列表<code>init</code>中特定项的和，这些项的索引与得到的逆序二进制数中“1”对应。解密的思路很直接，遍历所有元素并找出和刚好为c的项，就可以反推二进制数，乃至flag。</p>
<p>说起来容易，但程序如果这么实现，时间复杂度还是很高的。对思路重新优化，我们可以先把c视为若干项的和，在init中逐一找到各项并从c中减去。如果这一过程能完全进行那么c会被减到0，此时这些被减去的项就是我们要求的。按这个思路编写脚本，选取 [ c减去init某一项的剩余值，在过程不成立时表示回溯情况的偏移量，被减项的索引 ] 作为关键数据保存在栈（列表<code>memory</code>）中，最后剩余值=0时就可以从栈中得到各所求项的索引。（一开始没发现，后来flag交了之后想起来这有点像深度优先搜索算法?）</p>
<p>接下来按照索引求出二进制数，逆序还原，再转为bytes就看到flag了。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">Crypto.Util.number</span> <span class="kn">import</span> <span class="o">*</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">w</span><span class="o">=</span><span class="mi">16221818045491479713</span>
</span></span><span class="line"><span class="cl"><span class="n">n</span><span class="o">=</span><span class="mi">9702074289348763131102174377899883904548584105641045150269763589431293826913348632496775173099776917930517270317586740686008539085898910110442820776001061</span>
</span></span><span class="line"><span class="cl"><span class="n">c</span><span class="o">=</span><span class="mi">4795969289572314590787467990865205548430190921556722879891721107719262822789483863742356553249935437004378475661668768893462652103739250038700528111</span>
</span></span><span class="line"><span class="cl"><span class="n">init</span> <span class="o">=</span> <span class="p">[</span><span class="n">w</span><span class="o">*</span><span class="nb">pow</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span> <span class="o">%</span> <span class="n">n</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">512</span><span class="p">)]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">memory</span> <span class="o">=</span> <span class="p">[]</span>             <span class="c1">#记录上一次操作时的[剩余值,偏移量,在init中对应的索引位置]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">find</span><span class="p">(</span><span class="n">p</span><span class="p">):</span>			<span class="c1">#找到在init中小于给定数p的最大元素索引</span>
</span></span><span class="line"><span class="cl">	<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">512</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    	<span class="k">if</span> <span class="n">init</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">&lt;=</span><span class="n">p</span> <span class="ow">and</span> <span class="n">init</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="o">&gt;</span><span class="n">p</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        	<span class="k">return</span> <span class="n">i</span>
</span></span><span class="line"><span class="cl">    	<span class="k">if</span> <span class="n">p</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        	<span class="k">return</span> <span class="mi">0</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">forward</span><span class="p">(</span><span class="n">num</span><span class="p">,</span><span class="n">move</span><span class="p">,</span><span class="n">index</span><span class="p">):</span><span class="c1">#保存上一次操作数据，更新偏移量=0，计算剩余值</span>
</span></span><span class="line"><span class="cl">    <span class="n">datas</span><span class="o">=</span><span class="p">[</span><span class="n">num</span><span class="p">,</span><span class="n">move</span><span class="p">,</span><span class="n">index</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">    <span class="n">memory</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">datas</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">move</span><span class="o">=</span><span class="mi">0</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">num</span> <span class="o">-</span> <span class="n">init</span><span class="p">[</span><span class="n">index</span><span class="o">-</span><span class="n">move</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">num</span><span class="p">,</span><span class="n">move</span><span class="p">,</span><span class="n">index</span><span class="o">=</span><span class="n">c</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span> <span class="n">find</span><span class="p">(</span><span class="n">c</span><span class="p">)</span><span class="c1">#初始化</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">  	<span class="k">if</span> <span class="n">num</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="k">break</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  	<span class="k">elif</span> <span class="p">(</span><span class="n">num</span> <span class="o">-</span> <span class="n">init</span><span class="p">[</span><span class="n">index</span> <span class="o">-</span> <span class="n">move</span><span class="p">]</span><span class="o">&gt;=</span> <span class="n">init</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">or</span> <span class="n">num</span> <span class="o">==</span> <span class="n">init</span><span class="p">[</span><span class="n">index</span> <span class="o">-</span> <span class="n">move</span><span class="p">])</span> <span class="ow">and</span> <span class="n">move</span><span class="o">&lt;=</span><span class="n">index</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    	<span class="n">num</span><span class="o">=</span><span class="n">forward</span><span class="p">(</span><span class="n">num</span><span class="p">,</span><span class="n">move</span><span class="p">,</span> <span class="n">index</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    	<span class="n">index</span><span class="o">=</span><span class="n">find</span><span class="p">(</span><span class="n">num</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  	<span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    	<span class="n">num</span><span class="p">,</span><span class="n">move</span><span class="p">,</span><span class="n">index</span><span class="o">=</span><span class="n">memory</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">    	<span class="n">move</span><span class="o">+=</span><span class="mi">1</span>
</span></span><span class="line"><span class="cl">    	<span class="n">memory</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>		<span class="c1">#回溯到上一次操作，向左偏移+1</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">m</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;0&#39;</span><span class="p">]</span><span class="o">*</span><span class="mi">512</span>
</span></span><span class="line"><span class="cl"><span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">memory</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">  	<span class="n">m</span><span class="p">[</span><span class="n">k</span><span class="p">[</span><span class="mi">2</span><span class="p">]]</span><span class="o">=</span><span class="s1">&#39;1&#39;</span>
</span></span><span class="line"><span class="cl"><span class="n">m</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">m</span><span class="p">)[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">flag</span><span class="o">=</span><span class="n">long_to_bytes</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">m</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">flag</span><span class="p">)</span>
</span></span></code></pre></div>

<h3 class="relative group">BabyRSA 
    <div id="babyrsa" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#babyrsa" aria-label="锚点">#</a>
    </span>        
    
</h3>
<p>RSA在密码学领域是常见的非对称加密算法，破解的难度在于从公钥推出私钥，核心是超大整数的质因数分解。</p>
<p>
    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        srcset="
        /github.io/writeups/0xgame2023_crypto/image-20231005203125446_hu7058989216573832505.png 330w,
        /github.io/writeups/0xgame2023_crypto/image-20231005203125446_hu4933875480687831331.png 660w,
        /github.io/writeups/0xgame2023_crypto/image-20231005203125446_hu17032185996119237117.png 1024w,
        /github.io/writeups/0xgame2023_crypto/image-20231005203125446_hu7058549268639519415.png 2x"
        src="/github.io/writeups/0xgame2023_crypto/image-20231005203125446_hu4933875480687831331.png"
        alt="image-20231005203125446"
      />
      
    </figure>
</p>
<p>在一般的RSA加密中，m表示明文，n是一个超大整数，e为与φ(n)互素的任意整数，(e,n)作为公钥加密明文，得到密文c。解密需要私钥(d,n)，其中d是e关于模φ(n)的乘法逆元。要从密文c中解出明文m，只需要求出n的欧拉函数，为此需要将n质因数分解。</p>
<p>不同于传统的n=p*q这种只有两个质因数，本题的getN()函数直接给出了16个大质数相乘的超大数n，正常的分解因数算法肯定不好使了。在查找资料的过程中发现了名叫yafu的工具，顺利的分解了n。果然是整齐的16个质数</p>
<p>这样一来，就可以利用欧拉函数的性质，把各个因数减一再全部相乘，求出<strong>φ(n)</strong>，进而得到密钥去解密</p>
<p>
    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        srcset="
        /github.io/writeups/0xgame2023_crypto/image-20231005211459986_hu7884057054855564683.png 330w,
        /github.io/writeups/0xgame2023_crypto/image-20231005211459986_hu3491525383529578906.png 660w,
        /github.io/writeups/0xgame2023_crypto/image-20231005211459986_hu9715282411857942826.png 1024w,
        /github.io/writeups/0xgame2023_crypto/image-20231005211459986_hu9120318039833711482.png 2x"
        src="/github.io/writeups/0xgame2023_crypto/image-20231005211459986_hu3491525383529578906.png"
        alt="image-20231005211459986"
      />
      
    </figure>
</p>
<p>
    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        srcset="
        /github.io/writeups/0xgame2023_crypto/image-20231005211552255_hu10032655548680849758.png 330w,
        /github.io/writeups/0xgame2023_crypto/image-20231005211552255_hu11829100834008950002.png 660w,
        /github.io/writeups/0xgame2023_crypto/image-20231005211552255_hu4475931784601176563.png 1024w,
        /github.io/writeups/0xgame2023_crypto/image-20231005211552255_hu4903846208580165845.png 2x"
        src="/github.io/writeups/0xgame2023_crypto/image-20231005211552255_hu11829100834008950002.png"
        alt="image-20231005211552255"
      />
      
    </figure>
</p>
<p>还要注意求得的结果是<code>m*mask</code>，要再除以<code>mask</code>并用<code>long_to_bytes()</code>还原为字符串，才能得到正确的flag。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">Crypto.Util.number</span> <span class="kn">import</span> <span class="o">*</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">gmpy2</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">n</span><span class="o">=</span><span class="mi">93099494899964317992000886585964221136368777219322402558083737546844067074234332564205970300159140111778084916162471993849233358306940868232157447540597</span>
</span></span><span class="line"><span class="cl"><span class="n">e</span> <span class="o">=</span> <span class="mi">65537</span>
</span></span><span class="line"><span class="cl"><span class="n">c</span><span class="o">=</span><span class="mi">54352122428332145724828674757308827564883974087400720449151348825082737474080849774814293027988784740602148317713402758353653028988960687525211635107801</span>
</span></span><span class="line"><span class="cl"><span class="n">mask</span> <span class="o">=</span> <span class="mi">54257528450885974256117108479579183871895740052660152544049844968621224899247</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">factors</span><span class="o">=</span><span class="p">[</span><span class="mi">3479527847</span><span class="p">,</span><span class="mi">2864469667</span><span class="p">,</span><span class="mi">3561068417</span><span class="p">,</span><span class="mi">2770441151</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    	 <span class="mi">4134768233</span><span class="p">,</span><span class="mi">3281340371</span><span class="p">,</span><span class="mi">3111632101</span><span class="p">,</span><span class="mi">2821163021</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">   		 <span class="mi">3978177241</span><span class="p">,</span><span class="mi">3267547559</span><span class="p">,</span><span class="mi">2329990801</span><span class="p">,</span><span class="mi">3162958289</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">         <span class="mi">2995527113</span><span class="p">,</span><span class="mi">4160088337</span><span class="p">,</span><span class="mi">2732757047</span><span class="p">,</span><span class="mi">2436711469</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">phi</span><span class="o">=</span><span class="mi">1</span>
</span></span><span class="line"><span class="cl"><span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">factors</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">  <span class="n">phi</span> <span class="o">*=</span> <span class="p">(</span><span class="n">p</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>      <span class="c1">#欧拉函数</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">d</span><span class="o">=</span><span class="n">gmpy2</span><span class="o">.</span><span class="n">invert</span><span class="p">(</span><span class="n">e</span><span class="p">,</span><span class="n">phi</span><span class="p">)</span>    <span class="c1">#通过乘法逆元找到私钥d</span>
</span></span><span class="line"><span class="cl"><span class="n">m</span><span class="o">=</span><span class="nb">pow</span><span class="p">(</span><span class="n">c</span><span class="p">,</span><span class="n">d</span><span class="p">,</span><span class="n">n</span><span class="p">)</span>        <span class="c1">#解密</span>
</span></span><span class="line"><span class="cl"><span class="n">result</span><span class="o">=</span><span class="n">gmpy2</span><span class="o">.</span><span class="n">c_div</span><span class="p">(</span><span class="n">m</span><span class="p">,</span><span class="n">mask</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">flag</span><span class="o">=</span><span class="n">long_to_bytes</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">flag</span><span class="p">)</span>
</span></span></code></pre></div>

<h3 class="relative group">猜谜 
    <div id="%E7%8C%9C%E8%B0%9C" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#%E7%8C%9C%E8%B0%9C" aria-label="锚点">#</a>
    </span>        
    
</h3>
<blockquote>
<p>已知部分明文攻击</p>
</blockquote>
<p>题目还蛮善良的，给出加密<code>enc()</code>函数的同时还送上了解密的<code>dec()</code>函数，对密文进行第一次解密如下:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">c</span> <span class="o">=</span> <span class="sa">b</span><span class="s1">&#39;IPxYIYPYXPAn3nXX3IXA3YIAPn3xAYnYnPIIPAYYIA3nxxInXAYnIPAIxnXYYYIXIIPAXn3XYXIYAA3AXnx=&#39;</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">dec</span><span class="p">(</span><span class="n">c</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="c1">#b&#39;gWM\x84u\xe4N\x05x=a}\xe5\xb2-a}\x9f\x82\xf6C\xde[\\1\x89\xd4\xb1\xd0\x10\x9f&#39;</span>
</span></span></code></pre></div><p>然而第二层加密就不好办了，又又出现了未知的key。题目的意思是把key猜出来?</p>
<p>
    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        srcset="
        /github.io/writeups/0xgame2023_crypto/image-20231006173512624_hu5139824806972241313.png 330w,
        /github.io/writeups/0xgame2023_crypto/image-20231006173512624_hu17885427319131426220.png 660w,
        /github.io/writeups/0xgame2023_crypto/image-20231006173512624_hu12408049458459252803.png 1024w,
        /github.io/writeups/0xgame2023_crypto/image-20231006173512624_hu5110761482882435969.png 2x"
        src="/github.io/writeups/0xgame2023_crypto/image-20231006173512624_hu17885427319131426220.png"
        alt="image-20231006173512624"
      />
      
    </figure>
</p>
<p>分析代码，<code>i%7 </code>这段给了启示。无论<code>len(key)</code>有多大，只有前7位能发挥作用。不妨猜key就是7位的bytes。恰好我们知道flag的前七位是标准格式 <code>'0xGame{'</code> ，再利用xor运算的性质反推key成功。同样用xor解出flag</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">key</span><span class="o">=</span><span class="sa">b</span><span class="s1">&#39;&#39;</span>
</span></span><span class="line"><span class="cl"><span class="n">flag</span><span class="o">=</span><span class="s1">&#39;&#39;</span>
</span></span><span class="line"><span class="cl"><span class="n">flagformat</span><span class="o">=</span><span class="sa">b</span><span class="s1">&#39;0xGame{&#39;</span>
</span></span><span class="line"><span class="cl"><span class="n">text</span><span class="o">=</span><span class="sa">b</span><span class="s1">&#39;gWM</span><span class="se">\x84</span><span class="s1">u</span><span class="se">\xe4</span><span class="s1">N</span><span class="se">\x05</span><span class="s1">X=a}</span><span class="se">\xe5\xb2</span><span class="s1">-a}</span><span class="se">\x9f\x82\xf6</span><span class="s1">C</span><span class="se">\xde</span><span class="s1">[</span><span class="se">\\</span><span class="s1">l</span><span class="se">\x89\xd4\xb1\xd0\x10\x9f</span><span class="s1">&#39;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">7</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">  <span class="n">key</span> <span class="o">+=</span> <span class="p">(</span><span class="n">text</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">^</span> <span class="p">(</span><span class="n">flagformat</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">+</span><span class="n">i</span><span class="p">))</span><span class="o">.</span><span class="n">to_bytes</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="s1">&#39;big&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">text</span><span class="p">)):</span>
</span></span><span class="line"><span class="cl">   <span class="n">flag</span> <span class="o">+=</span> <span class="nb">chr</span><span class="p">((</span><span class="n">text</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">^</span> <span class="n">key</span><span class="p">[</span><span class="n">j</span><span class="o">%</span><span class="mi">7</span><span class="p">])</span><span class="o">-</span><span class="n">j</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">flag</span><span class="p">)</span>
</span></span></code></pre></div>

<h3 class="relative group">Vigenere 
    <div id="vigenere" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#vigenere" aria-label="锚点">#</a>
    </span>        
    
</h3>
<p>完全没见过的加密方式，百度搜索给出的解释是“使用一系列凯撒密码组成密码字母表的加密算法，属于多表密码的一种简单形式”。</p>
<p>直接找在线解密工具，摸索后发现解密需要密钥，而且只会对字母进行改变。查阅资料发现以下要点：</p>
<p>1.明文中的所有字母都在字母表上向后偏移某个数目后被替换成密文，偏移量与密钥相对应。</p>
<p>2.密钥若长度不够可以继续重复。</p>
<p>现在只需要得到密钥就可以破解flag，题目没有给出密钥的任何信息（也可以暴力破解？），但结合密文：<code>0dGmqk{79ap4i0522g0a67m6i196he52357q60f}</code>，猜测<code>0dGmqk</code>与<code>0xGame</code> 相对应，分析各字母前后的偏移量：6，0，12，4，6。对应<code>g</code>,<code>a</code>,<code>m</code>,<code>e</code>,<code>g</code> ,考虑到密钥的可重复性，取<code>game</code>作为密钥（看起来很靠谱），放到网站解密得到flag。</p>
<p>
    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        srcset="
        /github.io/writeups/0xgame2023_crypto/image-20231005175425302_hu18348986922696354134.png 330w,
        /github.io/writeups/0xgame2023_crypto/image-20231005175425302_hu1094437155407020798.png 660w,
        /github.io/writeups/0xgame2023_crypto/image-20231005175425302_hu9662176221507305115.png 1024w,
        /github.io/writeups/0xgame2023_crypto/image-20231005175425302_hu11171591287799758943.png 2x"
        src="/github.io/writeups/0xgame2023_crypto/image-20231005175425302_hu1094437155407020798.png"
        alt="image-20231005175425302"
      />
      
    </figure>
</p>


<h2 class="relative group">Week2 
    <div id="week2" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#week2" aria-label="锚点">#</a>
    </span>        
    
</h2>


<h3 class="relative group">EzLFSR 
    <div id="ezlfsr" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#ezlfsr" aria-label="锚点">#</a>
    </span>        
    
</h3>
<p>LFSR，又是很陌生的算法。</p>
<p>查了好几天资料，大概理解的差不多了。作为流密码的关键成分，LSFR也就是线性反馈移位寄存器，能够不断输出随机而长周期的序列。由此它可以作为流密钥产生器的线性驱动部分。寄存器的容量有限，当其中的数据整体左(右)移一位时，最左(右)面的数会溢出（输出）而最右(左)面会留出空位。为了有持续的输出，LSFR通过某种线性反馈函数计算出一个数补到空位，依次循环，源源不断。</p>
<p>
    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        srcset="
        /github.io/writeups/0xgame2023_crypto/image-20231014234348483_hu11601964219035224204.png 330w,
        /github.io/writeups/0xgame2023_crypto/image-20231014234348483_hu14162783939993120190.png 660w,
        /github.io/writeups/0xgame2023_crypto/image-20231014234348483_hu9971969886919738458.png 1024w,
        /github.io/writeups/0xgame2023_crypto/image-20231014234348483_hu14020919328820807400.png 2x"
        src="/github.io/writeups/0xgame2023_crypto/image-20231014234348483_hu14162783939993120190.png"
        alt="image-20231014234348483"
      />
      
    </figure>
</p>
<p>题中给出了初始状态和256位输出，根据移位寄存器的原理，我们可以用<code>initState[i:]+outputState[:i]</code>来表示第i组状态，同时给出计算补充右边空位数字的方法<code>lfsr()</code>，但其中mask未知。即不完全知道LFSR的反馈函数，但已知其级数n=128。而且明文中不包括<code>0xGame{}</code>，不能取巧反推反馈函数。</p>
<p>注意到反馈函数中有异或运算，<code>state</code>和<code>mask</code>中元素只能取0或1。可以把<code>mask[i]</code>理解为寄存器第i位的数是否参与到异或运算中（抽头）。用 \(x_i\)  表示<code>mask[i]</code>， \(k_i\) 至 \(k_{i+127}\) 表示第i组状态下寄存器各位数字，从数学角度可得到异或方程组：
$$
\begin{cases}
\quad k_{1}x_1\oplus k_{2}x_2 \oplus\cdots\oplus k_{128}x_{128} = k_{129} \\
\quad k_{2}x_1\oplus k_{3}x_2 \oplus\cdots\oplus k_{129}x_{128} = k_{130} \\
\quad k_{3}x_1\oplus k_{4}x_2 \oplus\cdots\oplus k_{130}x_{128} = k_{131} \\
\quad\quad\quad\quad\quad\quad\quad\enspace\cdots  \\
k_{128}x_1\oplus k_{129}x_2 \oplus\cdots\oplus k_{255}x_{128} = k_{256} \\
\end{cases}
$$
由于异或有“半加”的性质，用线性(加法)方程组类比异或方程组，上式等价于：
$$
\begin{cases}
\quad k_{1}x_1+ k_{2}x_2 +\cdots+ k_{128}x_{128} \equiv k_{129}(\bmod2)\\
\quad k_{2}x_1+ k_{3}x_2 +\cdots+ k_{129}x_{128} \equiv k_{130}(\bmod2)\\
\quad k_{3}x_1+ k_{4}x_2 +\cdots+ k_{130}x_{128} \equiv k_{131}(\bmod2)\\
\quad\quad\quad\quad\quad\quad\quad\enspace\cdots\\
k_{128}x_1+ k_{129}x_2 +\cdots+ k_{255}x_{128} \equiv k_{256}(\bmod2)\\
\end{cases}
$$
矩阵表示为：
$$
\begin{bmatrix}
k_1 &amp; k_2 &amp; k_3 &amp; \cdots &amp; k_{128}\\
k_2 &amp; k_3 &amp; k_4 &amp; \cdots &amp; k_{129}\\
k_3 &amp; k_4 &amp; k_5 &amp; \cdots &amp; k_{130}\\
\vdots &amp; \vdots &amp; \vdots &amp; \ddots &amp; \vdots\\
k_{128} &amp; k_{129} &amp; k_{130} &amp; \cdots &amp; k_{255}
\end{bmatrix}X=\begin{bmatrix}
k_{129}\\
k_{130}\\
k_{131}\\
\vdots\\
k_{256}\\
\end{bmatrix}
$$
借助软件Sage函数<code>solve_right()</code>，在有限环Zmod(2)中求解矩阵方程得到mask，转换为secret就可以得到flag</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1">#SageMath</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">Crypto.Util.number</span> <span class="kn">import</span> <span class="o">*</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">string2bits</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">b</span><span class="p">)</span> <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">s</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">bits2string</span><span class="p">(</span><span class="n">bs</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">s</span> <span class="o">=</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">b</span><span class="p">)</span> <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">bs</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">initState</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="n">outputState</span> <span class="o">=</span> <span class="s1">&#39;1101111111011101100001000011111101001000111000110100010011110111010011100110100100111001101010110110101110000011110101000110010010000011111111001111000110111001100111101110010100100001101001111110001010000100111101011011100010000000100000100000100111010110&#39;</span>
</span></span><span class="line"><span class="cl"><span class="n">outputState</span> <span class="o">=</span> <span class="n">string2bits</span><span class="p">(</span><span class="n">outputState</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">States_Array</span><span class="o">=</span><span class="p">[</span><span class="n">initState</span><span class="p">[</span><span class="n">i</span><span class="p">:]</span><span class="o">+</span><span class="n">outputState</span><span class="p">[:</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">128</span><span class="p">)]</span>
</span></span><span class="line"><span class="cl"><span class="n">states</span><span class="o">=</span><span class="n">matrix</span><span class="p">(</span><span class="n">Zmod</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span><span class="n">States_Array</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">output</span><span class="o">=</span><span class="n">matrix</span><span class="p">(</span><span class="n">Zmod</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span><span class="n">outputState</span><span class="p">[:</span><span class="mi">128</span><span class="p">])</span>
</span></span><span class="line"><span class="cl"><span class="n">output</span><span class="o">=</span><span class="n">output</span><span class="o">.</span><span class="n">transpose</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">mask</span><span class="o">=</span><span class="n">states</span><span class="o">.</span><span class="n">solve_right</span><span class="p">(</span><span class="n">output</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">mask</span><span class="o">=</span><span class="p">[</span><span class="n">i</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="p">(</span><span class="n">mask</span><span class="p">)]</span>
</span></span><span class="line"><span class="cl"><span class="n">secret</span><span class="o">=</span><span class="n">bits2string</span><span class="p">(</span><span class="n">mask</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">secret</span><span class="o">=</span><span class="n">long_to_bytes</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">secret</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">flag</span> <span class="o">=</span> <span class="s1">&#39;0xGame{&#39;</span><span class="o">+</span><span class="n">secret</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;}&#39;</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">flag</span><span class="p">)</span>
</span></span></code></pre></div>

<h3 class="relative group">中间的那个人 
    <div id="%E4%B8%AD%E9%97%B4%E7%9A%84%E9%82%A3%E4%B8%AA%E4%BA%BA" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#%E4%B8%AD%E9%97%B4%E7%9A%84%E9%82%A3%E4%B8%AA%E4%BA%BA" aria-label="锚点">#</a>
    </span>        
    
</h3>
<p>
    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        srcset="
        /github.io/writeups/0xgame2023_crypto/image-20231015123026520_hu4509958927958444201.png 330w,
        /github.io/writeups/0xgame2023_crypto/image-20231015123026520_hu13836829914380502144.png 660w,
        /github.io/writeups/0xgame2023_crypto/image-20231015123026520_hu15798667520882752940.png 1024w,
        /github.io/writeups/0xgame2023_crypto/image-20231015123026520_hu6264146637332578514.png 2x"
        src="/github.io/writeups/0xgame2023_crypto/image-20231015123026520_hu13836829914380502144.png"
        alt="image-20231015123026520"
      />
      
    </figure>
</p>
<p>题目模拟了Alice和Bob两人的加密通信场景，二人使用对称加密的CBC算法。因为未事先商量好密钥，所以加密一方要想办法把密文和特殊处理的密钥一并发送给对方，这里涉及DH密钥交换算法。我们作为“中间的那个人”，通过各种方式截获了二人通信的数据如下：
$$
P(A)\equiv Alice\equiv g^A (\bmod\ p)
$$</p>
<p>$$
P(B)\equiv Bob\equiv g^B(\bmod\ p)
$$</p>
<p>$$
key\equiv P(A)^B\equiv P(B)^A\equiv g^{AB}(\bmod\ p)
$$</p>
<p>由数学关系我们可反推：\(A\equiv \log_gP(A)\ (\bmod \ p)\) 和\(B\equiv \log_gP(B)\ \ (\bmod \ p)\)。即只需要计算其中一个离散对数，得到A或B的值，就可以计算出密钥key。</p>
<p>借助<code>SageMath</code>计算mod 2下的离散对数：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1">#SageMath</span>
</span></span><span class="line"><span class="cl"><span class="n">p</span><span class="o">=</span><span class="mi">250858685680234165065801734515633434653</span>
</span></span><span class="line"><span class="cl"><span class="n">G</span><span class="o">=</span><span class="n">GF</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">g</span><span class="o">=</span><span class="n">G</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">Bob</span><span class="o">=</span><span class="n">G</span><span class="p">(</span><span class="mi">33067794433420687511728239091450927373</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">B</span> <span class="o">=</span> <span class="n">discrete_log</span><span class="p">(</span><span class="n">Bob</span><span class="p">,</span><span class="n">g</span><span class="p">)</span>
</span></span></code></pre></div><p>再用python计算key，用题中给出的密文和初始化向量 $iv$ 解密，得到flag（其实可以放在<code>Sage</code>里面一步到位，但是我的<code>Sage</code>里面<code>Crypto.Cipher</code>库出了点小问题，就分开写了）</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">Crypto.Util.number</span> <span class="kn">import</span> <span class="o">*</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">Crypto.Cipher</span> <span class="kn">import</span> <span class="n">AES</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">hashlib</span> <span class="kn">import</span> <span class="n">sha256</span>
</span></span><span class="line"><span class="cl"><span class="n">g</span><span class="o">=</span><span class="mi">2</span>
</span></span><span class="line"><span class="cl"><span class="n">p</span><span class="o">=</span>    <span class="mi">250858685680234165065801734515633434653</span>
</span></span><span class="line"><span class="cl"><span class="n">Bob</span><span class="o">=</span>  <span class="mi">33067794433420687511728239091450927373</span>
</span></span><span class="line"><span class="cl"><span class="n">Alice</span><span class="o">=</span><span class="mi">235866450680721760403251513646370485539</span>
</span></span><span class="line"><span class="cl"><span class="n">enc</span><span class="o">=</span><span class="sa">b</span><span class="s1">&#39;s</span><span class="se">\x04\xbc\x8b</span><span class="s1">T6</span><span class="se">\x84</span><span class="s1">6</span><span class="se">\xd9\xd6\x83</span><span class="s1"> y</span><span class="se">\xaa</span><span class="s1">h</span><span class="se">\xde</span><span class="s1">@</span><span class="se">\xc9\x17\xdc\x04</span><span class="s1">v</span><span class="se">\x18\xef\xcf\xef\xc5\xfd</span><span class="s1">|</span><span class="se">\x0e\xca\n\xbd</span><span class="s1">#</span><span class="se">\x94</span><span class="s1">{</span><span class="se">\x8e</span><span class="s1">[.</span><span class="se">\xe8\xe1</span><span class="s1">GU</span><span class="se">\xfa</span><span class="s1">?</span><span class="se">\xda\x11</span><span class="s1">w&#39;</span>
</span></span><span class="line"><span class="cl"><span class="n">iv</span> <span class="o">=</span> <span class="sa">b</span><span class="s2">&#34;0xGame0xGameGAME&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">B</span> <span class="o">=</span> <span class="mi">1620639479</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">key</span> <span class="o">=</span> <span class="nb">pow</span><span class="p">(</span><span class="n">Alice</span><span class="p">,</span><span class="n">B</span><span class="p">,</span><span class="n">p</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">key</span> <span class="o">=</span> <span class="n">sha256</span><span class="p">(</span><span class="n">long_to_bytes</span><span class="p">(</span><span class="n">key</span><span class="p">))</span><span class="o">.</span><span class="n">digest</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="n">aes</span> <span class="o">=</span> <span class="n">AES</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">AES</span><span class="o">.</span><span class="n">MODE_CBC</span><span class="p">,</span> <span class="n">iv</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">flag</span> <span class="o">=</span> <span class="n">aes</span><span class="o">.</span><span class="n">decrypt</span><span class="p">(</span><span class="n">enc</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">flag</span><span class="p">)</span>
</span></span></code></pre></div>

<h2 class="relative group">Week3 
    <div id="week3" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#week3" aria-label="锚点">#</a>
    </span>        
    
</h2>


<h3 class="relative group">EzECC 
    <div id="ezecc" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#ezecc" aria-label="锚点">#</a>
    </span>        
    
</h3>
<p>ECC 即 <em>EllipseCurve Cryptography</em>，是一种基于椭圆曲线的公钥密码。在数学上椭圆曲线用
$$
y^2+axy+by=x^3+cx^2+dx+e
$$
来表示，而密码学中常取\(a=b=c=0\),得到椭圆曲线的一般形式
$$
y^2=x^3+dx+e
$$

    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        srcset="
        /github.io/writeups/0xgame2023_crypto/image-20231021220547269_hu4716333912910721112.png 330w,
        /github.io/writeups/0xgame2023_crypto/image-20231021220547269_hu275956839645463261.png 660w,
        /github.io/writeups/0xgame2023_crypto/image-20231021220547269_hu17644480236995678212.png 1024w,
        /github.io/writeups/0xgame2023_crypto/image-20231021220547269_hu18370774560970822908.png 2x"
        src="/github.io/writeups/0xgame2023_crypto/image-20231021220547269_hu275956839645463261.png"
        alt="image-20231021220547269"
      />
      
    </figure>
</p>
<p>密码学椭圆曲线一般定义在有限域GF(p)上。定义了二元运算：点与点的加法“ + ”，包括不同点相加以及点的自加（数乘）两种情况，与题中给出的 <code>add()</code> 函数和 <code>mul()</code> 函数相对应。同时，椭圆曲线上所有点（包括无穷远点\(O\)）与“ + ”运算构成abel群，满足封闭性，有限次运算后的结果依然在曲线上。</p>
<p>不同于数学中光滑连续的曲线，GF(p)上的椭圆曲线只包含离散而有限的整数点以及特殊的无穷远点，点的总数称为曲线的阶\(n\) ,若用 \(G\) 表示该曲线的生成元，则满足 \(nG = O\)。</p>
<p>曲线上两点满足 \(Q=mP\) ,则称 \(m\) 为椭圆曲线的离散对数，即 \(m=log_PQ\) 。ECC密码体系建立在离散对数求解难题的基础上。</p>
<p>根据以上性质，我们可以分析ECC的加密过程：首先接受方确定私钥 \(k\) 并选择椭圆曲线E(a,b)上基点 \(G\) ，计算出公钥 \(K=kG\)。将除私钥外的信息公开给发送方。发送方将明文编码成椭圆曲线上一点 \(M\)（但本题并没有这样做），随机选一个整数 \(r\) 计算出密文｛\(M+rK,rG\)｝即题中的 <code>{C_1,C_2}</code>。解密的思路比较直接，注意到数学关系
$$
\begin{cases}
C_1=M+rK=M+rkG\\
C_2=rG\\
C_1-kC_2=M+rkG-krG=M
\end{cases}
$$
只要求出私钥 \(k=log_GK\) 就可以求出 \(M\)，难题在于求解离散对数，还好SageMath有内置的求解函数。下图是利用<code>discrete_log()</code>函数求出 \(r\) 和 \(k\) 的过程：</p>
<p>
    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        srcset="
        /github.io/writeups/0xgame2023_crypto/image-20231020214551087_hu13475368453412672833.png 330w,
        /github.io/writeups/0xgame2023_crypto/image-20231020214551087_hu13646735555808905624.png 660w,
        /github.io/writeups/0xgame2023_crypto/image-20231020214551087_hu16288681302236315776.png 1024w,
        /github.io/writeups/0xgame2023_crypto/image-20231020214551087_hu2251459081842833090.png 2x"
        src="/github.io/writeups/0xgame2023_crypto/image-20231020214551087_hu13646735555808905624.png"
        alt="image-20231020214551087"
      />
      
    </figure>
</p>
<p>另外还有一种思路是求出 \(r=log_GC_2\) ，再根据\(M=C_1-rK\)求出明文，同样关键在离散对数。但从上图不难发现 \(r\) 是一个比较小的数，也可以爆破 \(r\) 来规避这一难题。（好像有师傅是这么做的）</p>
<p>求出 \(k\) 或 \(r\) 离flag就不远了。脚本求解：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">Crypto.Util.number</span> <span class="kn">import</span> <span class="o">*</span>
</span></span><span class="line"><span class="cl"><span class="n">q</span><span class="o">=</span><span class="mi">1139075593950729137191297</span>
</span></span><span class="line"><span class="cl"><span class="n">a</span><span class="o">=</span><span class="mi">930515656721155210883162</span>
</span></span><span class="line"><span class="cl"><span class="n">b</span><span class="o">=</span><span class="mi">631258792856205568553568</span>
</span></span><span class="line"><span class="cl"><span class="n">G</span> <span class="o">=</span> <span class="p">(</span><span class="mi">641322496020493855620384</span><span class="p">,</span> <span class="mi">437819621961768591577606</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">K</span> <span class="o">=</span> <span class="p">(</span><span class="mi">781988559490437792081406</span><span class="p">,</span> <span class="mi">76709224526706154630278</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">C_1</span><span class="o">=</span><span class="p">(</span><span class="mi">55568609433135042994738</span><span class="p">,</span> <span class="mi">626496338010773913984218</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">C_2</span><span class="o">=</span><span class="p">(</span><span class="mi">508425841918584868754821</span><span class="p">,</span> <span class="mi">816040882076938893064041</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">add</span><span class="p">(</span><span class="n">P</span><span class="p">,</span><span class="n">Q</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">	<span class="k">if</span> <span class="n">P</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="n">Q</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">and</span> <span class="n">P</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="n">Q</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
</span></span><span class="line"><span class="cl">		<span class="n">t</span> <span class="o">=</span> <span class="p">((</span><span class="n">Q</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">P</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">*</span> <span class="n">inverse</span><span class="p">(</span><span class="n">Q</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="n">P</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">q</span><span class="p">))</span> <span class="o">%</span><span class="n">q</span>
</span></span><span class="line"><span class="cl">	<span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">		<span class="n">t</span> <span class="o">=</span> <span class="p">((</span><span class="mi">3</span><span class="o">*</span><span class="n">P</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">P</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="n">a</span><span class="p">)</span> <span class="o">*</span> <span class="n">inverse</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">P</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">q</span><span class="p">))</span><span class="o">%</span><span class="n">q</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="n">x3</span> <span class="o">=</span> <span class="n">t</span><span class="o">*</span><span class="n">t</span> <span class="o">-</span> <span class="n">P</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">Q</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">	<span class="n">y3</span> <span class="o">=</span> <span class="n">t</span><span class="o">*</span><span class="p">(</span><span class="n">P</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">x3</span><span class="p">)</span> <span class="o">-</span> <span class="n">P</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">	<span class="k">return</span> <span class="p">(</span><span class="n">x3</span><span class="o">%</span><span class="n">q</span><span class="p">,</span> <span class="n">y3</span><span class="o">%</span><span class="n">q</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">mul</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="ow">not</span> <span class="n">t</span><span class="p">:</span> <span class="k">return</span> <span class="n">B</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">mul</span><span class="p">(</span><span class="n">t</span><span class="o">//</span><span class="mi">2</span><span class="p">,</span> <span class="n">add</span><span class="p">(</span><span class="n">A</span><span class="p">,</span><span class="n">A</span><span class="p">),</span> <span class="n">B</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">t</span><span class="o">&amp;</span><span class="mi">1</span> <span class="k">else</span> <span class="n">add</span><span class="p">(</span><span class="n">B</span><span class="p">,</span><span class="n">A</span><span class="p">)</span> <span class="k">if</span> <span class="n">B</span> <span class="k">else</span> <span class="n">A</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">r</span><span class="o">=</span><span class="mi">10077</span>
</span></span><span class="line"><span class="cl"><span class="n">k</span><span class="o">=</span><span class="mi">12515237792257199894</span>
</span></span><span class="line"><span class="cl"><span class="n">h</span><span class="o">=</span><span class="n">mul</span><span class="p">(</span><span class="n">r</span><span class="p">,</span><span class="n">K</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">H</span><span class="o">=</span><span class="p">(</span><span class="n">h</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">q</span><span class="o">-</span><span class="n">h</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
</span></span><span class="line"><span class="cl"><span class="n">m1</span><span class="p">,</span><span class="n">m2</span><span class="o">=</span><span class="n">add</span><span class="p">(</span><span class="n">C_1</span><span class="p">,</span><span class="n">H</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">flag</span> <span class="o">=</span> <span class="sa">b</span><span class="s1">&#39;0xGame{&#39;</span> <span class="o">+</span> <span class="n">long_to_bytes</span><span class="p">(</span><span class="n">m1</span><span class="p">)</span><span class="o">+</span><span class="n">long_to_bytes</span><span class="p">(</span><span class="n">m2</span><span class="p">)</span> <span class="o">+</span> <span class="sa">b</span><span class="s1">&#39;}&#39;</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">flag</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf8&#39;</span><span class="p">))</span>
</span></span></code></pre></div>

<h3 class="relative group">LLL-FirstBlood 
    <div id="lll-firstblood" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#lll-firstblood" aria-label="锚点">#</a>
    </span>        
    
</h3>
<p>初识LLL一头雾水，找了点格密码的资料看了看。实话说也没有理解透，但是发现题里给的<code>MakeMask()</code>函数很有意思。它会生成一个有限域GF(p)内的n阶方阵，各个位置的元素完全随机，但方阵的行列式恒为1。资料中称这样的矩阵为“幺模矩阵”，同时提到了格的一个性质：对于格的一组基 \(v_1,v_2,\cdots,v_n\) 可以进行如下三种变换，得到新的一组基与原来的基等价。</p>
<p>​				1.交换若干个基向量的顺序</p>
<p>​				2.对基向量取负 \(v_i\rightarrow-v_i\)</p>
<p>​				3.把某一基向量的k倍加到另一基向量上 \(v_i+kv_j\)</p>
<p>如果把基表示成矩阵 \(B_i\) 的形式，其中列向量为基向量，那么以上三种对基的变换可以写成 \(B_iU\) ，这里 \(U\) 为幺模矩阵。</p>
<p>换句话说，我们有基 \(B_1\)，而且 \(B_2=B_1U\) ，此时 \(B_1\) 与 \(B_2\) 等价，都会生成相同的格。</p>
<p>
    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        srcset="
        /github.io/writeups/0xgame2023_crypto/image-20231022002907661_hu5781981048050655648.png 330w,
        /github.io/writeups/0xgame2023_crypto/image-20231022002907661_hu13047240401801556561.png 660w,
        /github.io/writeups/0xgame2023_crypto/image-20231022002907661_hu332086403584963914.png 1024w,
        /github.io/writeups/0xgame2023_crypto/image-20231022002907661_hu10041993297211624721.png 2x"
        src="/github.io/writeups/0xgame2023_crypto/image-20231022002907661_hu13047240401801556561.png"
        alt="image-20231022002907661"
      />
      
    </figure>
</p>
<p>题中<code>M</code>是第一行为编码后的密文、其余位置是随机数的4阶方阵，<code>A</code>是随机生成的幺模矩阵。<code>C</code>是<code>M</code>与<code>A</code>相乘的结果。把<code>M</code>看成格，与幺模矩阵<code>A</code>相乘后得到的格<code>C</code>与<code>M</code>等价，即\( M \sim C\)。根据这种等价关系，我们尝试对<code>C</code>进行格基规约（LLL）化简为<code>M</code>。</p>
<p>这里设使用LLL算法得到的格基为K，其第一行的四个元素即为被切成四份的flag，用<code>long_to_bytes() </code>转化一下在拼一起就好了。</p>
<p>（PS：其实不太确定<code> C.LLL()</code> 得到的到底是不是<code>M</code>，毕竟只是试了下就出flag了，第一行肯定没问题，但是时间很紧其他行没有验证）</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1">#Sage</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">Crypto.Util.number</span> <span class="kn">import</span> <span class="o">*</span>
</span></span><span class="line"><span class="cl"><span class="n">p</span><span class="o">=</span><span class="mi">198880159035681668071031460916089145469</span>
</span></span><span class="line"><span class="cl"><span class="n">c</span><span class="o">=</span><span class="p">[[</span><span class="mi">1528140902799730745476264672501768332416990282355490479242339131918301176698899635154781328839496210200676497333428</span><span class="p">,</span><span class="mi">2081687444435007467807250373278513114045272585243815458840083487459795021302180077490134099644993120009567147202772</span><span class="p">,</span><span class="mi">3080873409460299046339495750746632185307246572817534784703936044874106809413620470006445984962733721029566440253675</span><span class="p">,</span><span class="mi">3491734341995174183626991907292607070252197520631412767989879432598743851171175369180080355977574296558734415823458</span><span class="p">],</span> <span class="p">[</span><span class="mi">2359409535809048127331244699867147546817134802610067329431135227991488324148374065940238308147500809599395748756798</span><span class="p">,</span><span class="mi">3191196199160821446351036460385791985682645040446022512790815348810555748825420237291839170774872264097466183208742</span><span class="p">,</span><span class="mi">4665346530155386457242345394284286198347336281451530670818113876767736288089400119492317775648206643242839430899283</span><span class="p">,</span><span class="mi">5369350746042850276067380638571565496087948799720968959426256192923852197959381101839484196445995828389461004495917</span><span class="p">],</span> 
</span></span><span class="line"><span class="cl"><span class="p">[</span><span class="mi">1641407111066265429602929560264443103285908072677065498760570514577412905392260182334706635555256537745902283191251</span><span class="p">,</span><span class="mi">2190536173399177167068153351271988931232272884028569669242062395087922275021628334797729266560930040116807133977244</span><span class="p">,</span><span class="mi">3127556759140845426132305699421707182108351516931881411928719802847628408656887897596425133523782526561471050447359</span><span class="p">,</span><span class="mi">3707239956529200159380870618471703921011276020439315706352183576289925263316580408968092016782483770373121972835410</span><span class="p">],</span> 
</span></span><span class="line"><span class="cl"><span class="p">[</span><span class="mi">9883814543195849013523934427451407019514807606993414569626142656857168165339</span><span class="p">,</span><span class="mi">13190422499129347541373922929251088892868361241120937213742340947017395215646</span><span class="p">,</span><span class="mi">18832738552342488056498211782604832513006649329982003661701684946590064734701</span><span class="p">,</span><span class="mi">22323329751908690611034666068697427811613727429398087082295754189068333861152</span><span class="p">]]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">C</span><span class="o">=</span><span class="n">Matrix</span><span class="p">(</span><span class="n">ZZ</span><span class="p">,</span><span class="n">c</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">K</span><span class="o">=</span><span class="n">C</span><span class="o">.</span><span class="n">LLL</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="n">flag</span><span class="o">=</span><span class="sa">b</span><span class="s1">&#39;&#39;</span>
</span></span><span class="line"><span class="cl"><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">K</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
</span></span><span class="line"><span class="cl">    <span class="n">flag</span><span class="o">+=</span><span class="n">long_to_bytes</span><span class="p">(</span><span class="o">-</span><span class="n">i</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">flag</span><span class="p">)</span>
</span></span></code></pre></div>

<h3 class="relative group">LLL-SecondBlood 
    <div id="lll-secondblood" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#lll-secondblood" aria-label="锚点">#</a>
    </span>        
    
</h3>
<p>
    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        srcset="
        /github.io/writeups/0xgame2023_crypto/image-20231022175051415_hu16764921090597459759.png 330w,
        /github.io/writeups/0xgame2023_crypto/image-20231022175051415_hu1695069603757939414.png 660w,
        /github.io/writeups/0xgame2023_crypto/image-20231022175051415_hu9138228409629577818.png 1024w,
        /github.io/writeups/0xgame2023_crypto/image-20231022175051415_hu10410307522977454964.png 2x"
        src="/github.io/writeups/0xgame2023_crypto/image-20231022175051415_hu1695069603757939414.png"
        alt="image-20231022175051415"
      />
      
    </figure>
</p>
<p>题中通过<code>encrypt()</code>函数向<code>noise_ </code>和 <code>mask_</code> 两个列表各添加4个大质数，并将<code>(mask*m + noise) % p </code>的结果添加到列表 <code>c_</code>  中。<code>m</code>是我们要找出的明文。理论上我们只要在有限域<code>GF(q)</code>中解出至少一组形如  <code>mask\_[i] * m+noise\_[i]=c\_[i]</code> 的方程就可以求出<code>m</code>。但本题最大的困难在于 <code>noise</code> 完全未知。注意到<code>mask</code>是511位的超大质数，再与<code>m</code>相乘的结果必然更大，而<code>noise</code>只是50位的质数，显然<code>mask*m</code> 远大于 <code>noise</code> ，我们可以把问题转化为已知高位的HNP问题，进一步，HNP问题可以在格上转化为CVP问题。</p>
<p>由于对格理论了解的不够充分，解题时借鉴了<a href="https://ctf-wiki.org/crypto/asymmetric/lattice/cvp/" target="_blank">CVP - CTF Wiki (ctf-wiki.org)</a>上的部分思路和方法。 令向量 \(M\)=mask ,\(C\)=c_ , 数量阵$P=pE$ ,参数$l\approx log^\frac{1}{2}p$  (这里没弄懂底数是几，我按lg算的)。我们构造用如下矩阵表示的格
$$
\begin{bmatrix}
P&amp;0\\
M&amp;\frac{1}{2^{l+1}}
\end{bmatrix}
$$
目标是在这个格上找到与已知向量 \(C\) 最近的向量 \(C&rsquo;\)，恰好这里 \(C&rsquo;=mM\) ，我们就可以求出m。</p>
<p>利用最近平面算法（Babai&rsquo;s nearest plane algorithm）求解CVP，得到flag，脚本如下（借鉴了一点点）</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1">#Sage</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">math</span> <span class="kn">import</span> <span class="o">*</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">Crypto.Util.number</span> <span class="kn">import</span> <span class="o">*</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">q</span> <span class="o">=</span> <span class="mi">9342426601783650861020119568565656404715236059903009041977149778244153930435908024696666887269890479558473622355346816236972767736577737332173213722012253</span>
</span></span><span class="line"><span class="cl"><span class="n">mask</span> <span class="o">=</span> <span class="p">[</span><span class="mi">6237128445236992920577225644858662677575951126467888858782461334057970069468925833844231116647406833999142659751374620280213290736114576089069396331226747</span><span class="p">,</span> <span class="mi">6368031389213953889417545256750169233725975229197446803885029159767701479445576860704561593200907482372690851152126782391126462547524526631934408981070841</span><span class="p">,</span> <span class="mi">5106473460982791188578285397420642137630347289252852045044021197988607082777231839839730169682158507822078412449827976663385282021916120837408192506341443</span><span class="p">,</span> <span class="mi">6318090842950331228033349517542810123596316850353637421587264886413877142612686177796023049304908696413386218992511112752788640732410845589679820003047667</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="n">c_</span> <span class="o">=</span> <span class="p">[</span><span class="mi">3823539664720029027586933152478492780438595004453489251844133830947165342839393878831914879334660250621422877333022321117120398528430519794109624186204492</span><span class="p">,</span> <span class="mi">1721659645750224819953244995460589691120672649732560768435214608167861246790136217219349234604724148039910656573436663379375048145045443527267790379816425</span><span class="p">,</span> <span class="mi">668633520079344839648950502380059311916108468801009386138810324259146523323704014491547148973835774917331333581475920804677395949854411894556705238578896</span><span class="p">,</span> <span class="mi">497860586379981076499130281851986010889356253371192266267220334713415782402939318483926418213877341511996918189750595755372560345085899109305344338944066</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">babai</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">w</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">A</span> <span class="o">=</span> <span class="n">A</span><span class="o">.</span><span class="n">LLL</span><span class="p">(</span><span class="n">delta</span><span class="o">=</span><span class="mf">0.75</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">G</span> <span class="o">=</span> <span class="n">A</span><span class="o">.</span><span class="n">gram_schmidt</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">    <span class="n">t</span> <span class="o">=</span> <span class="n">w</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">reversed</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">A</span><span class="o">.</span><span class="n">nrows</span><span class="p">())):</span>
</span></span><span class="line"><span class="cl">        <span class="n">c</span> <span class="o">=</span> <span class="p">((</span><span class="n">t</span> <span class="o">*</span> <span class="n">G</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">/</span> <span class="p">(</span><span class="n">G</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="n">G</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span><span class="o">.</span><span class="n">round</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">        <span class="n">t</span> <span class="o">-=</span> <span class="n">A</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="n">c</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">w</span> <span class="o">-</span> <span class="n">t</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">M</span> <span class="o">=</span> <span class="n">Matrix</span><span class="p">(</span><span class="n">QQ</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">M</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">q</span>
</span></span><span class="line"><span class="cl">    <span class="n">M</span><span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">mask</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="n">M</span><span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">**</span> <span class="p">(</span><span class="n">l</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="n">closest</span> <span class="o">=</span> <span class="n">babai</span><span class="p">(</span><span class="n">M</span><span class="p">,</span> <span class="n">vector</span><span class="p">(</span><span class="n">c_</span> <span class="o">+</span> <span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
</span></span><span class="line"><span class="cl"><span class="n">m</span><span class="o">=</span><span class="p">(</span><span class="n">closest</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="mi">2</span> <span class="o">**</span> <span class="p">(</span><span class="n">l</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)))</span> <span class="o">%</span> <span class="n">q</span>
</span></span><span class="line"><span class="cl"><span class="n">flag</span><span class="o">=</span><span class="n">long_to_bytes</span><span class="p">(</span><span class="mi">404417766109752774365993311026206252937822359426120081323087457724287886115277329019989616964477</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">flag</span><span class="p">)</span>
</span></span></code></pre></div>

<h2 class="relative group">Week4 
    <div id="week4" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#week4" aria-label="锚点">#</a>
    </span>        
    
</h2>


<h3 class="relative group">Normal ECC 
    <div id="normal-ecc" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#normal-ecc" aria-label="锚点">#</a>
    </span>        
    
</h3>
<p>又是一道ECC题，根据上周解题经验直接求 \(k=log_GK\)，但是数太大了，尝试跑了几个小时sage毫无作用。</p>
<p>暴力求 \(k\) 肯定是行不通的，这里只好换种思路。Hint中给出了 <code>ord(E)==p</code> 这样一个很特殊的条件，据此上网查照了若干资料，发现具有这种特殊性质的曲线有一个专属名称 “异常曲线” 即 <em>anomalous curve</em>，还有专门的攻击方法 “<em>Smart‘s Attack</em> ” 来求解离散对数。</p>
<blockquote>
<ul>
<li>
<p>将 \(P, Q\) 扩充成 \(E(Q_p)\) 下的点 \(P^′, Q^′\)。原来的离散对数是找到 \(n\) 使得 \(Q=nP\) 且 \(P,Q \in E(F_p) \)，现在只需先把 \(P, Q\) 拓展成 \(P^′, Q^′\)，然后找到 \(n\) 满足 \(Q^′−nP^′=O^′\)，其中 \(O^′\)是某个非整数点。</p>
</li>
<li>
<p>找到函数 \(ϕ:\mathbb{Q}→\mathbb{Q}\) 使得 \(Q=nP⇔ϕ(Q)=nϕ(P)\)。把椭圆曲线的加法「转换」成正常的加法，也就使离散对数问题变成简单的除法：
$$
n=\frac{ϕ(P)}{ϕ(Q)}
$$</p>
</li>
<li>
<p>为了套上 \(ϕ\)，我们把式子乘上 \(p\) 倍，得到  \(pO^′=pQ^′−npP^′\)。套上 \(ϕ\) 函数得到:
$$
n≡\frac{ϕ(pQ^′)}{ϕ(pP^′)}(\bmod\ p)
$$</p>
</li>
<li></li>
</ul>
</blockquote>
<p>这里引用了资料（<a href="https://utaha1228.github.io/ctf-note/2021/07/20/Smart-s-Attack/" target="_blank">Smart&rsquo;s Attack | Utaha&rsquo;s CTF Note</a>）中的一些分析，也比较幸运地找到了smart’s attack的代码。直接放到脚本里求出 \(k\)，再按常规思路解密 \(M\) 即可。</p>
<p>
    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        srcset="
        /github.io/writeups/0xgame2023_crypto/image-20231029155829848_hu6213793320728140903.png 330w,
        /github.io/writeups/0xgame2023_crypto/image-20231029155829848_hu11500621433487851478.png 660w,
        /github.io/writeups/0xgame2023_crypto/image-20231029155829848_hu16869588255416829567.png 1024w,
        /github.io/writeups/0xgame2023_crypto/image-20231029155829848_hu4354017172548227082.png 2x"
        src="/github.io/writeups/0xgame2023_crypto/image-20231029155829848_hu11500621433487851478.png"
        alt="image-20231029155829848"
      />
      
    </figure>
</p>
<p>完整的SageMath代码如下：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1">#sage</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">hashlib</span> <span class="kn">import</span> <span class="n">md5</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">MD5</span><span class="p">(</span><span class="n">m</span><span class="p">):</span><span class="k">return</span> <span class="n">md5</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">m</span><span class="p">)</span><span class="o">.</span><span class="n">encode</span><span class="p">())</span><span class="o">.</span><span class="n">hexdigest</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">SmartAttack</span><span class="p">(</span><span class="n">P</span><span class="p">,</span><span class="n">Q</span><span class="p">,</span><span class="n">p</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">E</span> <span class="o">=</span> <span class="n">P</span><span class="o">.</span><span class="n">curve</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="n">Eqp</span> <span class="o">=</span> <span class="n">EllipticCurve</span><span class="p">(</span><span class="n">Qp</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="p">[</span> <span class="n">ZZ</span><span class="p">(</span><span class="n">t</span><span class="p">)</span> <span class="o">+</span> <span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">p</span><span class="p">)</span><span class="o">*</span><span class="n">p</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">E</span><span class="o">.</span><span class="n">a_invariants</span><span class="p">()</span> <span class="p">])</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">P_Qps</span> <span class="o">=</span> <span class="n">Eqp</span><span class="o">.</span><span class="n">lift_x</span><span class="p">(</span><span class="n">ZZ</span><span class="p">(</span><span class="n">P</span><span class="o">.</span><span class="n">xy</span><span class="p">()[</span><span class="mi">0</span><span class="p">]),</span> <span class="nb">all</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="n">P_Qp</span> <span class="ow">in</span> <span class="n">P_Qps</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="n">GF</span><span class="p">(</span><span class="n">p</span><span class="p">)(</span><span class="n">P_Qp</span><span class="o">.</span><span class="n">xy</span><span class="p">()[</span><span class="mi">1</span><span class="p">])</span> <span class="o">==</span> <span class="n">P</span><span class="o">.</span><span class="n">xy</span><span class="p">()[</span><span class="mi">1</span><span class="p">]:</span>
</span></span><span class="line"><span class="cl">            <span class="k">break</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">Q_Qps</span> <span class="o">=</span> <span class="n">Eqp</span><span class="o">.</span><span class="n">lift_x</span><span class="p">(</span><span class="n">ZZ</span><span class="p">(</span><span class="n">Q</span><span class="o">.</span><span class="n">xy</span><span class="p">()[</span><span class="mi">0</span><span class="p">]),</span> <span class="nb">all</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="n">Q_Qp</span> <span class="ow">in</span> <span class="n">Q_Qps</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="n">GF</span><span class="p">(</span><span class="n">p</span><span class="p">)(</span><span class="n">Q_Qp</span><span class="o">.</span><span class="n">xy</span><span class="p">()[</span><span class="mi">1</span><span class="p">])</span> <span class="o">==</span> <span class="n">Q</span><span class="o">.</span><span class="n">xy</span><span class="p">()[</span><span class="mi">1</span><span class="p">]:</span>
</span></span><span class="line"><span class="cl">            <span class="k">break</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">p_times_P</span> <span class="o">=</span> <span class="n">p</span><span class="o">*</span><span class="n">P_Qp</span>
</span></span><span class="line"><span class="cl">    <span class="n">p_times_Q</span> <span class="o">=</span> <span class="n">p</span><span class="o">*</span><span class="n">Q_Qp</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">x_P</span><span class="p">,</span><span class="n">y_P</span> <span class="o">=</span> <span class="n">p_times_P</span><span class="o">.</span><span class="n">xy</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="n">x_Q</span><span class="p">,</span><span class="n">y_Q</span> <span class="o">=</span> <span class="n">p_times_Q</span><span class="o">.</span><span class="n">xy</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">phi_P</span> <span class="o">=</span> <span class="o">-</span><span class="p">(</span><span class="n">x_P</span><span class="o">/</span><span class="n">y_P</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">phi_Q</span> <span class="o">=</span> <span class="o">-</span><span class="p">(</span><span class="n">x_Q</span><span class="o">/</span><span class="n">y_Q</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">k</span> <span class="o">=</span> <span class="n">phi_Q</span><span class="o">/</span><span class="n">phi_P</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">ZZ</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">p</span><span class="o">=</span><span class="mi">11093300438765357787693823122068501933326829181518693650897090781749379503427651954028543076247583697669597230934286751428880673539155279232304301123931419</span>
</span></span><span class="line"><span class="cl"><span class="n">a</span><span class="o">=</span><span class="mi">490963434153515882934487973185142842357175523008183292296815140698999054658777820556076794490414610737654365807063916602037816955706321036900113929329671</span>
</span></span><span class="line"><span class="cl"><span class="n">b</span><span class="o">=</span><span class="mi">7668542654793784988436499086739239442915170287346121645884096222948338279165302213440060079141960679678526016348025029558335977042712382611197995002316466</span>
</span></span><span class="line"><span class="cl"><span class="n">E</span><span class="o">=</span><span class="n">EllipticCurve</span><span class="p">(</span><span class="n">GF</span><span class="p">(</span><span class="n">p</span><span class="p">),[</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">])</span>
</span></span><span class="line"><span class="cl"><span class="n">G</span><span class="o">=</span><span class="n">E</span><span class="p">(</span><span class="mi">4045939664332192284605924284905750194599514115248885617006435833400516258314135019849306107002566248677228498859069119557284134574413164612914441502516162</span><span class="p">,</span> <span class="mi">2847794627838984866808853730797794758944159239755903652092146137932959816137006954045318821531984715562135134681256836794735388745354065994745661832926404</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">K</span><span class="o">=</span><span class="n">E</span><span class="p">(</span><span class="mi">9857925495630886472871072848615069766635115253576843197716242339068269151167072057478472997523547299286363591371734837904400286993818976404285783613138603</span><span class="p">,</span> <span class="mi">9981865329938877904579306200429599690480093951555010258809210740458120586507638100468722807717390033784290215217185921690103757911870933497240578867679716</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">C1</span><span class="o">=</span><span class="n">E</span><span class="p">(</span><span class="mi">4349662787973529188741615503085571493571434812105745603868205005885464592782536198234863020839759214118594741734453731681116610298272107088387481605173124</span><span class="p">,</span> <span class="mi">10835708302355425798729392993451337162773253000440566333611610633234929294159743316615308778168947697567386109223430056006489876900001115634567822674333770</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">C2</span><span class="o">=</span><span class="n">E</span><span class="p">(</span><span class="mi">5193866657417498376737132473732737330916570240569047910293144235752602489388092937375844109374780050061859498276712695321973801207620914447727053101524592</span><span class="p">,</span> <span class="mi">684299154840371832195648774293174908478389728255128448106858267664482339440737099810868633906297465450436417091302739473407943955874648486647511119341978</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="k">assert</span> <span class="n">E</span><span class="o">.</span><span class="n">order</span><span class="p">()</span> <span class="o">==</span> <span class="n">p</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">k</span><span class="o">=</span><span class="n">SmartAttack</span><span class="p">(</span><span class="n">G</span><span class="p">,</span><span class="n">K</span><span class="p">,</span><span class="n">p</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">M</span><span class="o">=</span><span class="n">C1</span><span class="o">-</span><span class="n">k</span><span class="o">*</span><span class="n">C2</span>
</span></span><span class="line"><span class="cl"><span class="n">flag</span><span class="o">=</span><span class="s1">&#39;0xGame{&#39;</span><span class="o">+</span><span class="n">MD5</span><span class="p">(</span> <span class="n">M</span><span class="o">.</span><span class="n">xy</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span> <span class="p">)</span><span class="o">+</span><span class="s1">&#39;}&#39;</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">flag</span><span class="p">)</span>
</span></span></code></pre></div>
          
          
          
        </div>
        
        

        
        

        


  
      </div>
     
      
      
        
        
          
          
        
      <script>
        var oid = "views_writeups\\0xGame2023_Crypto\\index.md"
        var oid_likes = "likes_writeups\\0xGame2023_Crypto\\index.md"
      </script>
      
      
      <script type="text/javascript" src="/github.io/js/page.min.0860cf4e04fa2d72cc33ddba263083464d48f67de06114529043cb4623319efed4f484fd7f1730df5abea0e2da6f3538855634081d02f2d6e920b956f063e823.js" integrity="sha512-CGDPTgT6LXLMM926JjCDRk1I9n3gYRRSkEPLRiMxnv7U9IT9fxcw31q&#43;oOLabzU4hVY0CB0C8tbpILlW8GPoIw=="></script>
      
  
    </section>
  <footer class="pt-8 max-w-prose print:hidden">

    
  
    
    
    
    <div class="pt-8">
      <hr class="border-dotted border-neutral-300 dark:border-neutral-600" />
      <div class="flex justify-between pt-3">
        <span>
          
        </span>
        <span>
          
            <a class="flex text-right group ml-3" href="/github.io/writeups/0xgame2023_re/">
              <span class="flex flex-col">
                <span
                  class="mt-[0.1rem] leading-6 group-hover:underline group-hover:decoration-primary-500"
                  >0xGame2023 Reverse</span
                >
                <span class="mt-[0.1rem] text-xs text-neutral-500 dark:text-neutral-400">
                  
                    <time datetime="2024-01-02T00:00:00&#43;00:00">2024-01-02</time>
                  
                </span>
              </span>
              <span
                class="ml-3 text-neutral-700 group-hover:text-primary-600 ltr:inline rtl:hidden dark:text-neutral dark:group-hover:text-primary-400"
                >&rarr;</span
              >
              <span
                class="mr-3 text-neutral-700 group-hover:text-primary-600 ltr:hidden rtl:inline dark:text-neutral dark:group-hover:text-primary-400"
                >&larr;</span
              >
            </a>
          
        </span>
      </div>
    </div>
  


    
  </footer>
</article>

      <div id="top-scroller" class="pointer-events-none absolute top-[110vh] bottom-0 w-12 ltr:right-0 rtl:left-0">
  <a href="#the-top"
    class="pointer-events-auto sticky top-[calc(100vh-5.5rem)] flex h-12 w-12 mb-16 items-center justify-center rounded-full bg-neutral/50 text-xl text-neutral-700 hover:text-primary-600 dark:bg-neutral-800/50 dark:text-neutral dark:hover:text-primary-400"
    aria-label="返回顶部" title="返回顶部">
    &uarr;
  </a>
</div>
    </main><footer id="site-footer" class="py-10 print:hidden">
  
  
    
    <nav class="flex flex-row pb-4 text-base font-medium text-neutral-500 dark:text-neutral-400">
      <ul class="flex flex-col list-none sm:flex-row">
        
        <li class="flex mb-1 ltr:text-right rtl:text-left sm:mb-0 ltr:sm:mr-7 ltr:sm:last:mr-0 rtl:sm:ml-7 rtl:sm:last:ml-0">
          <a class="decoration-primary-500 hover:underline hover:decoration-2 hover:underline-offset-2 flex items-center" href="/github.io/about/"
            title="">
            
            About
          </a>
        </li>
        
      </ul>
    </nav>
    
  
  <div class="flex items-center justify-between">

    
    
    <p class="text-sm text-neutral-500 dark:text-neutral-400">
      &copy;
      2024
      1n1t
    </p>
    

    
    
    <p class="text-xs text-neutral-500 dark:text-neutral-400">
      
      
      由 <a class="hover:underline hover:decoration-primary-400 hover:text-primary-500"
        href="https://gohugo.io/" target="_blank" rel="noopener noreferrer">Hugo</a> &amp; <a class="hover:underline hover:decoration-primary-400 hover:text-primary-500"
        href="https://blowfish.page/" target="_blank" rel="noopener noreferrer">Blowfish</a> 强力驱动
    </p>
    

  </div>
  <script>
    
    mediumZoom(document.querySelectorAll("img:not(.nozoom)"), {
      margin: 24,
      background: 'rgba(0,0,0,0.5)',
      scrollOffset: 0,
    })
    
  </script>
  
  
  <script type="text/javascript" src="/github.io/js/process.min.ee03488f19c93c2efb199e2e3014ea5f3cb2ce7d45154adb3399a158cac27ca52831db249ede5bb602700ef87eb02434139de0858af1818ab0fb4182472204a4.js" integrity="sha512-7gNIjxnJPC77GZ4uMBTqXzyyzn1FFUrbM5mhWMrCfKUoMdsknt5btgJwDvh&#43;sCQ0E53ghYrxgYqw&#43;0GCRyIEpA=="></script>
  
  
</footer>
<div
  id="search-wrapper"
  class="invisible fixed inset-0 flex h-screen w-screen cursor-default flex-col bg-neutral-500/50 p-4 backdrop-blur-sm dark:bg-neutral-900/50 sm:p-6 md:p-[10vh] lg:p-[12vh]"
  data-url="http://localhost:1313/github.io/"
  style="z-index:500"
>
  <div
    id="search-modal"
    class="flex flex-col w-full max-w-3xl min-h-0 mx-auto border rounded-md shadow-lg top-20 border-neutral-200 bg-neutral dark:border-neutral-700 dark:bg-neutral-800"
  >
    <header class="relative z-10 flex items-center justify-between flex-none px-2">
      <form class="flex items-center flex-auto min-w-0">
        <div class="flex items-center justify-center w-8 h-8 text-neutral-400">
          

  <span class="relative block icon">
    <svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="search" class="svg-inline--fa fa-search fa-w-16" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M505 442.7L405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9 0 208 0S0 93.1 0 208s93.1 208 208 208c48.3 0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9 0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7 0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7 0 128 57.2 128 128 0 70.7-57.2 128-128 128z"/></svg>

  </span>


        </div>
        <input
          type="search"
          id="search-query"
          class="flex flex-auto h-12 mx-1 bg-transparent appearance-none focus:outline-dotted focus:outline-2 focus:outline-transparent"
          placeholder="搜索"
          tabindex="0"
        />
      </form>
      <button
        id="close-search-button"
        class="flex items-center justify-center w-8 h-8 text-neutral-700 hover:text-primary-600 dark:text-neutral dark:hover:text-primary-400"
        title="关闭 (Esc)"
      >
        

  <span class="relative block icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><path fill="currentColor" d="M310.6 361.4c12.5 12.5 12.5 32.75 0 45.25C304.4 412.9 296.2 416 288 416s-16.38-3.125-22.62-9.375L160 301.3L54.63 406.6C48.38 412.9 40.19 416 32 416S15.63 412.9 9.375 406.6c-12.5-12.5-12.5-32.75 0-45.25l105.4-105.4L9.375 150.6c-12.5-12.5-12.5-32.75 0-45.25s32.75-12.5 45.25 0L160 210.8l105.4-105.4c12.5-12.5 32.75-12.5 45.25 0s12.5 32.75 0 45.25l-105.4 105.4L310.6 361.4z"/></svg>

  </span>


      </button>
    </header>
    <section class="flex-auto px-2 overflow-auto">
      <ul id="search-results">
        
      </ul>
    </section>
  </div>
</div>

  </div>
</body>

</html>
